<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 ggtreeExtra | Data Integration, Manipulation and Visualization of Phylogenetic Trees</title>
  <meta name="description" content="Chapter 10 ggtreeExtra | Data Integration, Manipulation and Visualization of Phylogenetic Trees" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 ggtreeExtra | Data Integration, Manipulation and Visualization of Phylogenetic Trees" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 ggtreeExtra | Data Integration, Manipulation and Visualization of Phylogenetic Trees" />
  
  
  



<meta name="date" content="2020-10-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="chapter9.html"/>
<link rel="next" href="chapter11.html"/>
<script src="libs/header-attrs-2.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/font-awesome-5.3.1/css/fontawesome-all.min.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/pathseg-1.0.2/pathseg.js"></script>
<script src="libs/comic-0.961/comic.min.js"></script>
<script src="libs/comicR-binding-0.2/comicR.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>üìñ Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#motivation"><i class="fa fa-check"></i>üéØ Motivation</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#citation"><i class="fa fa-check"></i>üìù Citation</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#book-structure"><i class="fa fa-check"></i>üìö Book structure</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#want-to-help"><i class="fa fa-check"></i>üíñ Want to help?</a></li>
</ul></li>
<li class="part"><span><b>Part I: Tree data input, output and manipulation</b></span></li>
<li class="chapter" data-level="1" data-path="chapter1.html"><a href="chapter1.html"><i class="fa fa-check"></i><b>1</b> Importing Tree with Data</a>
<ul>
<li class="chapter" data-level="1.1" data-path="chapter1.html"><a href="chapter1.html#pc"><i class="fa fa-check"></i><b>1.1</b> Overview of Phylogenetic Tree Construction</a></li>
<li class="chapter" data-level="1.2" data-path="chapter1.html"><a href="chapter1.html#format"><i class="fa fa-check"></i><b>1.2</b> Phylogenetic Tree Formats</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="chapter1.html"><a href="chapter1.html#newick-tree-format"><i class="fa fa-check"></i><b>1.2.1</b> Newick tree format</a></li>
<li class="chapter" data-level="1.2.2" data-path="chapter1.html"><a href="chapter1.html#nexus-tree-format"><i class="fa fa-check"></i><b>1.2.2</b> NEXUS tree format</a></li>
<li class="chapter" data-level="1.2.3" data-path="chapter1.html"><a href="chapter1.html#nhxtext"><i class="fa fa-check"></i><b>1.2.3</b> New Hampshire eXtended format</a></li>
<li class="chapter" data-level="1.2.4" data-path="chapter1.html"><a href="chapter1.html#jplace-format"><i class="fa fa-check"></i><b>1.2.4</b> Jplace format</a></li>
<li class="chapter" data-level="1.2.5" data-path="chapter1.html"><a href="chapter1.html#software-outputs"><i class="fa fa-check"></i><b>1.2.5</b> Software outputs</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="chapter1.html"><a href="chapter1.html#getting-tree-data-with-treeio"><i class="fa fa-check"></i><b>1.3</b> Getting Tree Data with <em>treeio</em></a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="chapter1.html"><a href="chapter1.html#overview-of-treeio"><i class="fa fa-check"></i><b>1.3.1</b> Overview of <em>treeio</em></a></li>
<li class="chapter" data-level="1.3.2" data-path="chapter1.html"><a href="chapter1.html#function-demonstration"><i class="fa fa-check"></i><b>1.3.2</b> Function Demonstration</a></li>
<li class="chapter" data-level="1.3.3" data-path="chapter1.html"><a href="chapter1.html#as-treedata"><i class="fa fa-check"></i><b>1.3.3</b> Converting other tree-like object to <code>phylo</code> or <code>treedata</code> object</a></li>
<li class="chapter" data-level="1.3.4" data-path="chapter1.html"><a href="chapter1.html#get-treedata-data"><i class="fa fa-check"></i><b>1.3.4</b> Getting information from <code>treedata</code> object</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="chapter1.html"><a href="chapter1.html#summary1"><i class="fa fa-check"></i><b>1.4</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chapter2.html"><a href="chapter2.html"><i class="fa fa-check"></i><b>2</b> Manipulating Tree with Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="chapter2.html"><a href="chapter2.html#tidytree"><i class="fa fa-check"></i><b>2.1</b> Manipulating tree data using tidy interface</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="chapter2.html"><a href="chapter2.html#the-phylo-object"><i class="fa fa-check"></i><b>2.1.1</b> The <code>phylo</code> object</a></li>
<li class="chapter" data-level="2.1.2" data-path="chapter2.html"><a href="chapter2.html#the-treedata-object"><i class="fa fa-check"></i><b>2.1.2</b> The <code>treedata</code> object</a></li>
<li class="chapter" data-level="2.1.3" data-path="chapter2.html"><a href="chapter2.html#accesor-tidytree"><i class="fa fa-check"></i><b>2.1.3</b> Access related nodes</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="chapter2.html"><a href="chapter2.html#data-integration"><i class="fa fa-check"></i><b>2.2</b> Data Integration</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="chapter2.html"><a href="chapter2.html#merge-tree"><i class="fa fa-check"></i><b>2.2.1</b> Combining tree data</a></li>
<li class="chapter" data-level="2.2.2" data-path="chapter2.html"><a href="chapter2.html#link-external-data"><i class="fa fa-check"></i><b>2.2.2</b> Linking external data to phylogeny</a></li>
<li class="chapter" data-level="2.2.3" data-path="chapter2.html"><a href="chapter2.html#grouping-taxa"><i class="fa fa-check"></i><b>2.2.3</b> Grouping taxa</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="chapter2.html"><a href="chapter2.html#reroot-treeio"><i class="fa fa-check"></i><b>2.3</b> Rerooting tree</a></li>
<li class="chapter" data-level="2.4" data-path="chapter2.html"><a href="chapter2.html#rescale-treeio"><i class="fa fa-check"></i><b>2.4</b> Rescaling Tree Branches</a></li>
<li class="chapter" data-level="2.5" data-path="chapter2.html"><a href="chapter2.html#subsetting-tree-with-data"><i class="fa fa-check"></i><b>2.5</b> Subsetting Tree with Data</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="chapter2.html"><a href="chapter2.html#remove-tip"><i class="fa fa-check"></i><b>2.5.1</b> Removing tips in a phylogenetic tree</a></li>
<li class="chapter" data-level="2.5.2" data-path="chapter2.html"><a href="chapter2.html#subset-tip"><i class="fa fa-check"></i><b>2.5.2</b> Subsetting tree by tip label</a></li>
<li class="chapter" data-level="2.5.3" data-path="chapter2.html"><a href="chapter2.html#subset-node"><i class="fa fa-check"></i><b>2.5.3</b> Subsetting tree by internal node number</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="chapter2.html"><a href="chapter2.html#ggtree-fortify"><i class="fa fa-check"></i><b>2.6</b> Manipulating tree data for visualization</a></li>
<li class="chapter" data-level="2.7" data-path="chapter2.html"><a href="chapter2.html#summary2"><i class="fa fa-check"></i><b>2.7</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chapter3.html"><a href="chapter3.html"><i class="fa fa-check"></i><b>3</b> Exporting tree with data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="index.html"><a href="index.html#introduction"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="chapter3.html"><a href="chapter3.html#exporting-tree-data-to-beast-nexus-format"><i class="fa fa-check"></i><b>3.2</b> Exporting Tree Data to <em>BEAST</em> Nexus Format</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="chapter3.html"><a href="chapter3.html#exportingconverting-software-output"><i class="fa fa-check"></i><b>3.2.1</b> Exporting/converting software output</a></li>
<li class="chapter" data-level="3.2.2" data-path="chapter3.html"><a href="chapter3.html#combining-tree-with-external-data"><i class="fa fa-check"></i><b>3.2.2</b> Combining tree with external data</a></li>
<li class="chapter" data-level="3.2.3" data-path="chapter3.html"><a href="chapter3.html#merging-tree-data-from-different-sources"><i class="fa fa-check"></i><b>3.2.3</b> Merging tree data from different sources</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="chapter3.html"><a href="chapter3.html#write-jtree"><i class="fa fa-check"></i><b>3.3</b> Exporting Tree Data to <em>jtree</em> Format</a></li>
<li class="chapter" data-level="3.4" data-path="chapter3.html"><a href="chapter3.html#summary3"><i class="fa fa-check"></i><b>3.4</b> Summary</a></li>
</ul></li>
<li class="part"><span><b>Part II: Tree data visualization and annotation</b></span></li>
<li class="chapter" data-level="4" data-path="chapter4.html"><a href="chapter4.html"><i class="fa fa-check"></i><b>4</b> Phylogenetic Tree Visualization</a>
<ul>
<li class="chapter" data-level="4.1" data-path="index.html"><a href="index.html#introduction"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="chapter4.html"><a href="chapter4.html#visualizing-phylogenetic-tree-with-ggtree"><i class="fa fa-check"></i><b>4.2</b> Visualizing Phylogenetic Tree with <em>ggtree</em></a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="chapter4.html"><a href="chapter4.html#basic-tree-visualization"><i class="fa fa-check"></i><b>4.2.1</b> Basic Tree Visualization</a></li>
<li class="chapter" data-level="4.2.2" data-path="chapter4.html"><a href="chapter4.html#tree-layouts"><i class="fa fa-check"></i><b>4.2.2</b> Layouts of phylogenetic tree</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="chapter4.html"><a href="chapter4.html#displaying-tree-components"><i class="fa fa-check"></i><b>4.3</b> Displaying Tree Components</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="chapter4.html"><a href="chapter4.html#geom-trescale"><i class="fa fa-check"></i><b>4.3.1</b> Displaying tree scale (evolution distance)</a></li>
<li class="chapter" data-level="4.3.2" data-path="chapter4.html"><a href="chapter4.html#geom-nodepoint"><i class="fa fa-check"></i><b>4.3.2</b> Displaying nodes/tips</a></li>
<li class="chapter" data-level="4.3.3" data-path="chapter4.html"><a href="chapter4.html#displaying-labels"><i class="fa fa-check"></i><b>4.3.3</b> Displaying labels</a></li>
<li class="chapter" data-level="4.3.4" data-path="chapter4.html"><a href="chapter4.html#displaying-root-edge"><i class="fa fa-check"></i><b>4.3.4</b> Displaying root edge</a></li>
<li class="chapter" data-level="4.3.5" data-path="chapter4.html"><a href="chapter4.html#color-tree"><i class="fa fa-check"></i><b>4.3.5</b> Color tree</a></li>
<li class="chapter" data-level="4.3.6" data-path="chapter4.html"><a href="chapter4.html#rescale-tree"><i class="fa fa-check"></i><b>4.3.6</b> Rescale tree</a></li>
<li class="chapter" data-level="4.3.7" data-path="chapter4.html"><a href="chapter4.html#modify-compenents-of-a-theme"><i class="fa fa-check"></i><b>4.3.7</b> Modify compenents of a theme</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="chapter4.html"><a href="chapter4.html#visualize-a-list-of-trees"><i class="fa fa-check"></i><b>4.4</b> Visualize a list of trees</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="chapter4.html"><a href="chapter4.html#annotate-one-tree-with-values-from-different-variables"><i class="fa fa-check"></i><b>4.4.1</b> Annotate one tree with values from different variables</a></li>
<li class="chapter" data-level="4.4.2" data-path="chapter4.html"><a href="chapter4.html#densitree"><i class="fa fa-check"></i><b>4.4.2</b> DensiTree</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="chapter4.html"><a href="chapter4.html#summary4"><i class="fa fa-check"></i><b>4.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chapter5.html"><a href="chapter5.html"><i class="fa fa-check"></i><b>5</b> Phylogenetic Tree Annotation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="chapter5.html"><a href="chapter5.html#visualizing-and-annotating-tree-using-grammar-of-graphics"><i class="fa fa-check"></i><b>5.1</b> Visualizing and Annotating Tree using Grammar of Graphics</a></li>
<li class="chapter" data-level="5.2" data-path="chapter5.html"><a href="chapter5.html#layers-for-tree-annotation"><i class="fa fa-check"></i><b>5.2</b> Layers for Tree Annotation</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="chapter5.html"><a href="chapter5.html#colored-strips"><i class="fa fa-check"></i><b>5.2.1</b> Colored strips</a></li>
<li class="chapter" data-level="5.2.2" data-path="chapter5.html"><a href="chapter5.html#highlight-clades"><i class="fa fa-check"></i><b>5.2.2</b> Highlight clades</a></li>
<li class="chapter" data-level="5.2.3" data-path="chapter5.html"><a href="chapter5.html#taxa-connection"><i class="fa fa-check"></i><b>5.2.3</b> Taxa connection</a></li>
<li class="chapter" data-level="5.2.4" data-path="chapter5.html"><a href="chapter5.html#uncertainty-of-evolutionary-inference"><i class="fa fa-check"></i><b>5.2.4</b> Uncertainty of evolutionary inference</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="chapter5.html"><a href="chapter5.html#tree-annotation-with-output-from-evolution-software"><i class="fa fa-check"></i><b>5.3</b> Tree annotation with output from evolution software</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="chapter5.html"><a href="chapter5.html#tree-annotation-using-data-from-evolutionary-analysis-software"><i class="fa fa-check"></i><b>5.3.1</b> Tree annotation using data from evolutionary analysis software</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="chapter5.html"><a href="chapter5.html#summary5"><i class="fa fa-check"></i><b>5.4</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chapter6.html"><a href="chapter6.html"><i class="fa fa-check"></i><b>6</b> Visual Exploration of Phylogenetic Tree</a>
<ul>
<li class="chapter" data-level="6.1" data-path="chapter6.html"><a href="chapter6.html#viewing-selected-clade"><i class="fa fa-check"></i><b>6.1</b> Viewing Selected Clade</a></li>
<li class="chapter" data-level="6.2" data-path="chapter6.html"><a href="chapter6.html#scale-clade"><i class="fa fa-check"></i><b>6.2</b> Scaling Selected Clade</a></li>
<li class="chapter" data-level="6.3" data-path="chapter6.html"><a href="chapter6.html#collapsing-and-expanding-clade"><i class="fa fa-check"></i><b>6.3</b> Collapsing and Expanding Clade</a></li>
<li class="chapter" data-level="6.4" data-path="chapter6.html"><a href="chapter6.html#group-taxa-vis"><i class="fa fa-check"></i><b>6.4</b> Grouping Taxa</a></li>
<li class="chapter" data-level="6.5" data-path="chapter6.html"><a href="chapter6.html#exploring-tree-structure"><i class="fa fa-check"></i><b>6.5</b> Exploring tree structure</a></li>
<li class="chapter" data-level="6.6" data-path="chapter6.html"><a href="chapter6.html#summary6"><i class="fa fa-check"></i><b>6.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chapter7.html"><a href="chapter7.html"><i class="fa fa-check"></i><b>7</b> Plotting tree with data</a>
<ul>
<li class="chapter" data-level="7.1" data-path="chapter7.html"><a href="chapter7.html#attach-operator"><i class="fa fa-check"></i><b>7.1</b> Mapping data to the tree structure</a></li>
<li class="chapter" data-level="7.2" data-path="chapter7.html"><a href="chapter7.html#facet_plot"><i class="fa fa-check"></i><b>7.2</b> Aligning graph to the tree based on tree structure</a></li>
<li class="chapter" data-level="7.3" data-path="chapter7.html"><a href="chapter7.html#gheatmap"><i class="fa fa-check"></i><b>7.3</b> Visualize tree with associated matrix</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="chapter7.html"><a href="chapter7.html#gheatmap-ggnewscale"><i class="fa fa-check"></i><b>7.3.1</b> Visualize tree with multiple associated matrix</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="chapter7.html"><a href="chapter7.html#msaplot"><i class="fa fa-check"></i><b>7.4</b> Visualize tree with multiple sequence alignment</a></li>
<li class="chapter" data-level="7.5" data-path="chapter7.html"><a href="chapter7.html#composite_plot"><i class="fa fa-check"></i><b>7.5</b> Composite plots</a></li>
<li class="chapter" data-level="7.6" data-path="chapter7.html"><a href="chapter7.html#ggtree_object"><i class="fa fa-check"></i><b>7.6</b> The <code>ggtree</code> object</a></li>
<li class="chapter" data-level="7.7" data-path="chapter7.html"><a href="chapter7.html#summary7"><i class="fa fa-check"></i><b>7.7</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="chapter8.html"><a href="chapter8.html"><i class="fa fa-check"></i><b>8</b> Annotating Tree with Silhouette Images and Sub-plots</a>
<ul>
<li class="chapter" data-level="8.1" data-path="chapter8.html"><a href="chapter8.html#ggimage"><i class="fa fa-check"></i><b>8.1</b> Annotating Tree with Images</a></li>
<li class="chapter" data-level="8.2" data-path="chapter8.html"><a href="chapter8.html#phylopic"><i class="fa fa-check"></i><b>8.2</b> Annotating Tree with Phylopic</a></li>
<li class="chapter" data-level="8.3" data-path="chapter8.html"><a href="chapter8.html#subplots"><i class="fa fa-check"></i><b>8.3</b> Annotating Tree with Sub-plots</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="chapter8.html"><a href="chapter8.html#annotate-with-bar-charts"><i class="fa fa-check"></i><b>8.3.1</b> Annotate with bar charts</a></li>
<li class="chapter" data-level="8.3.2" data-path="chapter8.html"><a href="chapter8.html#annotate-with-pie-charts"><i class="fa fa-check"></i><b>8.3.2</b> Annotate with pie charts</a></li>
<li class="chapter" data-level="8.3.3" data-path="chapter8.html"><a href="chapter8.html#annotate-with-other-types-of-charts"><i class="fa fa-check"></i><b>8.3.3</b> Annotate with other types of charts</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="chapter8.html"><a href="chapter8.html#phylomoji"><i class="fa fa-check"></i><b>8.4</b> Have Fun with Phylomoji</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="chapter8.html"><a href="chapter8.html#emoji-in-circularfan-layout-tree"><i class="fa fa-check"></i><b>8.4.1</b> Emoji in circular/fan layout tree</a></li>
<li class="chapter" data-level="8.4.2" data-path="chapter8.html"><a href="chapter8.html#emoji-to-label-clades"><i class="fa fa-check"></i><b>8.4.2</b> Emoji to label clades</a></li>
<li class="chapter" data-level="8.4.3" data-path="chapter8.html"><a href="chapter8.html#apple-color-emoji"><i class="fa fa-check"></i><b>8.4.3</b> Apple Color Emoji</a></li>
<li class="chapter" data-level="8.4.4" data-path="chapter8.html"><a href="chapter8.html#phylomoji-in-ascii-art"><i class="fa fa-check"></i><b>8.4.4</b> Phylomoji in ASCII art</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="chapter9.html"><a href="chapter9.html"><i class="fa fa-check"></i><b>9</b> ggtree for other tree-like objects</a>
<ul>
<li class="chapter" data-level="9.1" data-path="chapter9.html"><a href="chapter9.html#ggtree-for-phylogenetic-tree-objects"><i class="fa fa-check"></i><b>9.1</b> ggtree for phylogenetic tree objects</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="chapter9.html"><a href="chapter9.html#phylobase"><i class="fa fa-check"></i><b>9.1.1</b> The phylo4 and phylo4d objects</a></li>
<li class="chapter" data-level="9.1.2" data-path="chapter9.html"><a href="chapter9.html#phylog"><i class="fa fa-check"></i><b>9.1.2</b> The phylog object</a></li>
<li class="chapter" data-level="9.1.3" data-path="chapter9.html"><a href="chapter9.html#phyloseq"><i class="fa fa-check"></i><b>9.1.3</b> The phyloseq object</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="chapter9.html"><a href="chapter9.html#dendrogram"><i class="fa fa-check"></i><b>9.2</b> ggtree for dendrograms</a></li>
<li class="chapter" data-level="9.3" data-path="chapter9.html"><a href="chapter9.html#igraph"><i class="fa fa-check"></i><b>9.3</b> ggtree for tree graph</a></li>
<li class="chapter" data-level="9.4" data-path="chapter9.html"><a href="chapter9.html#ggtree-for-other-tree-like-structure"><i class="fa fa-check"></i><b>9.4</b> ggtree for other tree-like structure</a></li>
</ul></li>
<li class="part"><span><b>Part III: ggtree extensions</b></span></li>
<li class="chapter" data-level="10" data-path="chapter10.html"><a href="chapter10.html"><i class="fa fa-check"></i><b>10</b> ggtreeExtra</a>
<ul>
<li class="chapter" data-level="10.1" data-path="index.html"><a href="index.html#introduction"><i class="fa fa-check"></i><b>10.1</b> Introduction</a></li>
<li class="chapter" data-level="10.2" data-path="chapter10.html"><a href="chapter10.html#aligning-graphs-to-the-tree-based-on-tree-structure"><i class="fa fa-check"></i><b>10.2</b> Aligning graphs to the tree based on tree structure</a></li>
<li class="chapter" data-level="10.3" data-path="chapter10.html"><a href="chapter10.html#aligning-multiple-graphs-to-the-tree-for-multi-dimensional-data"><i class="fa fa-check"></i><b>10.3</b> Aligning multiple graphs to the tree for multi-dimensional data</a></li>
<li class="chapter" data-level="10.4" data-path="chapter10.html"><a href="chapter10.html#api-to-link-ggtree-and-ggplot2."><i class="fa fa-check"></i><b>10.4</b> API to link <em>ggtree</em> and <em>ggplot2</em>.</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="chapter11.html"><a href="chapter11.html"><i class="fa fa-check"></i><b>11</b> Other ggtree extensions</a>
<ul>
<li class="chapter" data-level="11.1" data-path="chapter11.html"><a href="chapter11.html#MicrobiotaProcess"><i class="fa fa-check"></i><b>11.1</b> Taxonomy annotation using MicrobiotaProcess</a></li>
<li class="chapter" data-level="11.2" data-path="chapter11.html"><a href="chapter11.html#visualizing-phylogenetic-network"><i class="fa fa-check"></i><b>11.2</b> Visualizing phylogenetic network</a></li>
</ul></li>
<li class="part"><span><b>Part IV: Miscellaneous topics</b></span></li>
<li class="chapter" data-level="12" data-path="chapter12.html"><a href="chapter12.html"><i class="fa fa-check"></i><b>12</b> ggtree utilities</a>
<ul>
<li class="chapter" data-level="12.1" data-path="chapter12.html"><a href="chapter12.html#facet-utils"><i class="fa fa-check"></i><b>12.1</b> Facet utilities</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="chapter12.html"><a href="chapter12.html#facet_widths"><i class="fa fa-check"></i><b>12.1.1</b> facet_widths</a></li>
<li class="chapter" data-level="12.1.2" data-path="chapter12.html"><a href="chapter12.html#facet_labeller"><i class="fa fa-check"></i><b>12.1.2</b> facet_labeller</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="chapter12.html"><a href="chapter12.html#geom2"><i class="fa fa-check"></i><b>12.2</b> Geometric layers</a></li>
<li class="chapter" data-level="12.3" data-path="chapter12.html"><a href="chapter12.html#layout-utilities"><i class="fa fa-check"></i><b>12.3</b> Layout utilities</a></li>
<li class="chapter" data-level="12.4" data-path="chapter12.html"><a href="chapter12.html#scale-utilities"><i class="fa fa-check"></i><b>12.4</b> Scale utilities</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="chapter12.html"><a href="chapter12.html#xlim_expand"><i class="fa fa-check"></i><b>12.4.1</b> Expand x limit for specific panel</a></li>
<li class="chapter" data-level="12.4.2" data-path="chapter12.html"><a href="chapter12.html#ggexpand"><i class="fa fa-check"></i><b>12.4.2</b> Expand plot limit by ratio of plot range</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="chapter12.html"><a href="chapter12.html#tree-data-utilities"><i class="fa fa-check"></i><b>12.5</b> Tree data utilities</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="chapter12.html"><a href="chapter12.html#td_filter"><i class="fa fa-check"></i><b>12.5.1</b> Filter tree data</a></li>
<li class="chapter" data-level="12.5.2" data-path="chapter12.html"><a href="chapter12.html#td_unnest"><i class="fa fa-check"></i><b>12.5.2</b> Flatten list-column tree data</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="chapter12.html"><a href="chapter12.html#tree-utilities"><i class="fa fa-check"></i><b>12.6</b> Tree utilities</a>
<ul>
<li class="chapter" data-level="12.6.1" data-path="chapter12.html"><a href="chapter12.html#tiporder"><i class="fa fa-check"></i><b>12.6.1</b> Extract tip order</a></li>
<li class="chapter" data-level="12.6.2" data-path="chapter12.html"><a href="chapter12.html#padding-taxa-labels"><i class="fa fa-check"></i><b>12.6.2</b> Padding taxa labels</a></li>
</ul></li>
<li class="chapter" data-level="12.7" data-path="chapter12.html"><a href="chapter12.html#identify"><i class="fa fa-check"></i><b>12.7</b> Interactive ggtree annotation</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="chapter13.html"><a href="chapter13.html"><i class="fa fa-check"></i><b>13</b> Gallery of reproducible examples</a>
<ul>
<li class="chapter" data-level="13.1" data-path="chapter13.html"><a href="chapter13.html#hpv58"><i class="fa fa-check"></i><b>13.1</b> Visualizing pairwise nucleotide sequence distance with phylogenetic tree</a></li>
<li class="chapter" data-level="13.2" data-path="chapter13.html"><a href="chapter13.html#symbolic-bootstrap"><i class="fa fa-check"></i><b>13.2</b> Displaying different symbolic points for bootstrap values.</a></li>
<li class="chapter" data-level="13.3" data-path="chapter13.html"><a href="chapter13.html#phylo-grouping"><i class="fa fa-check"></i><b>13.3</b> Highlighting different groups.</a></li>
<li class="chapter" data-level="13.4" data-path="chapter13.html"><a href="chapter13.html#genome-locus"><i class="fa fa-check"></i><b>13.4</b> Phylogenetic tree with genome locus structure</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="faq.html"><a href="faq.html"><i class="fa fa-check"></i><b>A</b> Frequently asked questions</a>
<ul>
<li class="chapter" data-level="A.1" data-path="faq.html"><a href="faq.html#installation"><i class="fa fa-check"></i><b>A.1</b> Installation</a></li>
<li class="chapter" data-level="A.2" data-path="faq.html"><a href="faq.html#faq-r"><i class="fa fa-check"></i><b>A.2</b> Basic R related</a>
<ul>
<li class="chapter" data-level="A.2.1" data-path="faq.html"><a href="faq.html#faq-local-file"><i class="fa fa-check"></i><b>A.2.1</b> Use your local file</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="faq.html"><a href="faq.html#faq-aes-mapping"><i class="fa fa-check"></i><b>A.3</b> Aesthetic mapping</a>
<ul>
<li class="chapter" data-level="A.3.1" data-path="faq.html"><a href="faq.html#faq-inherit-aes"><i class="fa fa-check"></i><b>A.3.1</b> Inherit <em>aes</em></a></li>
<li class="chapter" data-level="A.3.2" data-path="faq.html"><a href="faq.html#faq-dollar-aes"><i class="fa fa-check"></i><b>A.3.2</b> Never use <code>$</code> in aes</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="faq.html"><a href="faq.html#faq-text"><i class="fa fa-check"></i><b>A.4</b> Text &amp; Label</a>
<ul>
<li class="chapter" data-level="A.4.1" data-path="faq.html"><a href="faq.html#faq-label-truncated"><i class="fa fa-check"></i><b>A.4.1</b> Tip label truncated</a></li>
<li class="chapter" data-level="A.4.2" data-path="faq.html"><a href="faq.html#faq-modify-label"><i class="fa fa-check"></i><b>A.4.2</b> Modify (tip) labels</a></li>
<li class="chapter" data-level="A.4.3" data-path="faq.html"><a href="faq.html#faq-formatting-label"><i class="fa fa-check"></i><b>A.4.3</b> Formatting (tip) labels</a></li>
<li class="chapter" data-level="A.4.4" data-path="faq.html"><a href="faq.html#faq-ggrepel"><i class="fa fa-check"></i><b>A.4.4</b> Avoid overlapping text labels</a></li>
<li class="chapter" data-level="A.4.5" data-path="faq.html"><a href="faq.html#faq-bootstrap"><i class="fa fa-check"></i><b>A.4.5</b> Bootstrap values from newick format</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="faq.html"><a href="faq.html#branch-setting"><i class="fa fa-check"></i><b>A.5</b> Branch setting</a>
<ul>
<li class="chapter" data-level="A.5.1" data-path="faq.html"><a href="faq.html#change-branch-length-of-outgroup"><i class="fa fa-check"></i><b>A.5.1</b> Change branch length of outgroup</a></li>
<li class="chapter" data-level="A.5.2" data-path="faq.html"><a href="faq.html#bind-tip"><i class="fa fa-check"></i><b>A.5.2</b> Attach a new tip to a tree</a></li>
<li class="chapter" data-level="A.5.3" data-path="faq.html"><a href="faq.html#change-colours-or-line-types-of-arbitrary-selected-branches"><i class="fa fa-check"></i><b>A.5.3</b> Change colours or line types of arbitrary selected branches</a></li>
<li class="chapter" data-level="A.5.4" data-path="faq.html"><a href="faq.html#arbitrary-point"><i class="fa fa-check"></i><b>A.5.4</b> Add an arbitrary point to a branch</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="faq.html"><a href="faq.html#different-x-axis-labels-for-different-facet-panels"><i class="fa fa-check"></i><b>A.6</b> Different x-axis labels for different facet panels</a></li>
<li class="chapter" data-level="A.7" data-path="faq.html"><a href="faq.html#faq-under-the-tree"><i class="fa fa-check"></i><b>A.7</b> Plot something behind the phylogeny</a></li>
<li class="chapter" data-level="A.8" data-path="faq.html"><a href="faq.html#faq-enlarge-center-space"><i class="fa fa-check"></i><b>A.8</b> Enlarge center space in circular/fan layout tree</a></li>
<li class="chapter" data-level="A.9" data-path="faq.html"><a href="faq.html#use-the-most-distant-tip-from-the-root-as-the-origin-of-the-time-scale"><i class="fa fa-check"></i><b>A.9</b> Use the most distant tip from the root as the origin of the time scale</a></li>
<li class="chapter" data-level="A.10" data-path="faq.html"><a href="faq.html#export-edit"><i class="fa fa-check"></i><b>A.10</b> Edit tree graphic details</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="related-tools.html"><a href="related-tools.html"><i class="fa fa-check"></i><b>B</b> Related tools</a>
<ul>
<li class="chapter" data-level="B.1" data-path="chapter11.html"><a href="chapter11.html#MicrobiotaProcess"><i class="fa fa-check"></i><b>B.1</b> MicrobiotaProcess: Convert <em>taxonomy</em> or hierachical clustering result to <em>treedata</em></a></li>
<li class="chapter" data-level="B.2" data-path="related-tools.html"><a href="related-tools.html#rtol"><i class="fa fa-check"></i><b>B.2</b> rtol: An R interface to Open Tree API</a></li>
<li class="chapter" data-level="B.3" data-path="related-tools.html"><a href="related-tools.html#plotly"><i class="fa fa-check"></i><b>B.3</b> Convert ggtree to plotly object</a></li>
<li class="chapter" data-level="B.4" data-path="related-tools.html"><a href="related-tools.html#commicR"><i class="fa fa-check"></i><b>B.4</b> Comic (xkcd-like) phylogenetic tree</a></li>
<li class="chapter" data-level="B.5" data-path="related-tools.html"><a href="related-tools.html#ascii-tree"><i class="fa fa-check"></i><b>B.5</b> Print ASCII-art rooted tree</a></li>
<li class="chapter" data-level="B.6" data-path="related-tools.html"><a href="related-tools.html#facet-zoom"><i class="fa fa-check"></i><b>B.6</b> Zoom in selected portion</a></li>
</ul></li>
<li class="chapter" data-level="C" data-path="ggimage-tips.html"><a href="ggimage-tips.html"><i class="fa fa-check"></i><b>C</b> Tips for using <code>ggtree</code> with <code>ggimage</code></a>
<ul>
<li class="chapter" data-level="C.1" data-path="ggimage-tips.html"><a href="ggimage-tips.html#ggimage-rm-image-bg"><i class="fa fa-check"></i><b>C.1</b> Example 1: Remove background of images</a></li>
<li class="chapter" data-level="C.2" data-path="ggimage-tips.html"><a href="ggimage-tips.html#ggimage-bgimage"><i class="fa fa-check"></i><b>C.2</b> Example 2: Plot tree on a background image</a></li>
</ul></li>
<li class="chapter" data-level="D" data-path="run-ggtree-in-jupyter-notebook.html"><a href="run-ggtree-in-jupyter-notebook.html"><i class="fa fa-check"></i><b>D</b> Run ggtree in Jupyter notebook</a></li>
<li class="chapter" data-level="E" data-path="figures-and-tables.html"><a href="figures-and-tables.html"><i class="fa fa-check"></i><b>E</b> Figures and Tables</a></li>
<li class="chapter" data-level="F" data-path="session-info.html"><a href="session-info.html"><i class="fa fa-check"></i><b>F</b> Session Info</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Integration, Manipulation and Visualization of Phylogenetic Trees</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapter10" class="section level1" number="10">
<h1><span class="header-section-number">Chapter 10</span> ggtreeExtra</h1>
<div id="introduction" class="section level2" number="10.1">
<h2><span class="header-section-number">10.1</span> Introduction</h2>
<p>Phylogenetic trees can be easily visualized with multiple layout using <a href="http://bioconductor.org/packages/ggtree">ggtree</a> <span class="citation">(Yu et al. <a href="#ref-yu_ggtree:_2017" role="doc-biblioref">2017</a>)</span>. It provides programmable visualization and annotation of phylogenetic trees. It not only supports visualization and annotation of phylogenetic trees but also other tree-like structures. So it can be generally applied in related biological researches. None R package, to our knowledge, are developed to align multiple layers to the circular trees or other layout trees. To solve the problem, We developed <a href="http://bioconductor.org/packages/ggtreeExtra">ggtreeExtra</a>, which can align associated graphs to <code>circular</code>, <code>fan</code> or <code>radial</code> and other <code>rectangular</code> layout tree. <a href="http://bioconductor.org/packages/ggtreeExtra">ggtreeExtra</a> provides function, <code>geom_fruit</code> to align graphs to the tree. But the associated graphs will align in different position. So we also developed <code>geom_fruit_list</code> to add multiple layers in the same position. Furthermore, The <code>axis</code> of external layers can be added using the <code>axis.params=list(axis="x")</code> in <code>geom_fruit</code>. The <code>grid lines</code> of external layers can be added using the <code>grid.params=list()</code> in <code>geom_fruit</code>. These functions are based on <a href="https://CRAN.R-project.org/package=ggplot2">ggplot2</a> using grammar of graphics <span class="citation">(Wickham <a href="#ref-wickham_ggplot2_2009" role="doc-biblioref">2009</a>)</span>.</p>
</div>
<div id="aligning-graphs-to-the-tree-based-on-tree-structure" class="section level2" number="10.2">
<h2><span class="header-section-number">10.2</span> Aligning graphs to the tree based on tree structure</h2>
<p>The phylogenetic trees are often visualized with different graph created using associated datasets. Like the <code>geom_facet</code> of <a href="http://bioconductor.org/packages/ggtree">ggtree</a> <span class="citation">(Yu et al. <a href="#ref-yu_ggtree:_2017" role="doc-biblioref">2017</a>)</span>, <a href="http://bioconductor.org/packages/ggtreeExtra">ggtreeExtra</a> also provides <code>geom_fruit</code> layer which accepts an input <code>data.frame</code> and a <code>geom</code> function to plot the input data. The data will be visualized in an additional position of the plot. <code>geom_fruit</code> also is a general function to link graphs to phylogenetic trees. It will re-orders the input data based on the tree structure and displayed the data with the associated <code>geom</code> at specific position.</p>
<p>The <code>geom_fruit</code> is designed to work with most of <code>geom</code> layers defined in <a href="https://CRAN.R-project.org/package=ggplot2">ggplot2</a>. It control the position of graphs by <code>position</code> parameter, which was provided the <code>Position</code> object of <a href="http://bioconductor.org/packages/ggtreeExtra">ggtreeExtra</a>. The default position parameters is ‚Äòauto‚Äô. This means that the <code>geom_bar</code> will use <code>position_stackx()</code>, <code>geom_violin</code> and <code>geom_boxplot</code> will use <code>position_dodgex()</code>, <code>geom_point</code> and <code>geom_tile</code> will use <code>position_identityx()</code>. So if the <code>geom</code> defined in other <a href="https://CRAN.R-project.org/package=ggplot2">ggplot2</a>-based packages has <code>position</code> parameter, which support the result of a call to a position adjustment function, it also can work with <code>geom_fruit</code>, such as <code>geom_star</code> in <a href="https://CRAN.R-project.org/package=ggstar">ggstar</a>, which provides the regular polygon layer for easily discernible shapes based on the grammar of <a href="https://CRAN.R-project.org/package=ggplot2">ggplot2</a>. Since the <a href="https://CRAN.R-project.org/package=ggplot2">ggplot2</a> community keeps expanding and more <code>geom</code> layers will be implemented in either <a href="https://CRAN.R-project.org/package=ggplot2">ggplot2</a> or other extensions, <code>geom_fruit</code> also will gain more power to present data in future.</p>


<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="chapter10.html#cb223-1"></a><span class="kw">library</span>(ggtreeExtra)</span>
<span id="cb223-2"><a href="chapter10.html#cb223-2"></a><span class="kw">library</span>(ggtree)</span>
<span id="cb223-3"><a href="chapter10.html#cb223-3"></a><span class="kw">library</span>(phyloseq)</span>
<span id="cb223-4"><a href="chapter10.html#cb223-4"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb223-5"><a href="chapter10.html#cb223-5"></a></span>
<span id="cb223-6"><a href="chapter10.html#cb223-6"></a><span class="kw">data</span>(<span class="st">&quot;GlobalPatterns&quot;</span>)</span>
<span id="cb223-7"><a href="chapter10.html#cb223-7"></a>GP &lt;-<span class="st"> </span>GlobalPatterns</span>
<span id="cb223-8"><a href="chapter10.html#cb223-8"></a>GP &lt;-<span class="st"> </span><span class="kw">prune_taxa</span>(<span class="kw">taxa_sums</span>(GP) <span class="op">&gt;</span><span class="st"> </span><span class="dv">600</span>, GP)</span>
<span id="cb223-9"><a href="chapter10.html#cb223-9"></a><span class="kw">sample_data</span>(GP)<span class="op">$</span>human &lt;-<span class="st"> </span><span class="kw">get_variable</span>(GP, <span class="st">&quot;SampleType&quot;</span>) <span class="op">%in%</span></span>
<span id="cb223-10"><a href="chapter10.html#cb223-10"></a><span class="st">                              </span><span class="kw">c</span>(<span class="st">&quot;Feces&quot;</span>, <span class="st">&quot;Skin&quot;</span>)</span>
<span id="cb223-11"><a href="chapter10.html#cb223-11"></a>mergedGP &lt;-<span class="st"> </span><span class="kw">merge_samples</span>(GP, <span class="st">&quot;SampleType&quot;</span>)</span>
<span id="cb223-12"><a href="chapter10.html#cb223-12"></a>mergedGP &lt;-<span class="st"> </span><span class="kw">rarefy_even_depth</span>(mergedGP,<span class="dt">rngseed=</span><span class="dv">394582</span>)</span>
<span id="cb223-13"><a href="chapter10.html#cb223-13"></a>mergedGP &lt;-<span class="st"> </span><span class="kw">tax_glom</span>(mergedGP,<span class="st">&quot;Order&quot;</span>)</span>
<span id="cb223-14"><a href="chapter10.html#cb223-14"></a></span>
<span id="cb223-15"><a href="chapter10.html#cb223-15"></a>melt_simple &lt;-<span class="st"> </span><span class="kw">psmelt</span>(mergedGP) <span class="op">%&gt;%</span></span>
<span id="cb223-16"><a href="chapter10.html#cb223-16"></a><span class="st">               </span><span class="kw">filter</span>(Abundance <span class="op">&lt;</span><span class="st"> </span><span class="dv">120</span>) <span class="op">%&gt;%</span></span>
<span id="cb223-17"><a href="chapter10.html#cb223-17"></a><span class="st">               </span><span class="kw">select</span>(OTU, <span class="dt">val=</span>Abundance)</span>
<span id="cb223-18"><a href="chapter10.html#cb223-18"></a></span>
<span id="cb223-19"><a href="chapter10.html#cb223-19"></a>p &lt;-<span class="st"> </span><span class="kw">ggtree</span>(mergedGP, <span class="dt">layout=</span><span class="st">&quot;fan&quot;</span>, <span class="dt">open.angle=</span><span class="dv">10</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb223-20"><a href="chapter10.html#cb223-20"></a><span class="st">     </span><span class="kw">geom_tippoint</span>(<span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">color=</span>Phylum), </span>
<span id="cb223-21"><a href="chapter10.html#cb223-21"></a>                   <span class="dt">size=</span><span class="fl">1.5</span>,</span>
<span id="cb223-22"><a href="chapter10.html#cb223-22"></a>                   <span class="dt">show.legend=</span><span class="ot">FALSE</span>)</span>
<span id="cb223-23"><a href="chapter10.html#cb223-23"></a>p &lt;-<span class="st"> </span><span class="kw">rotate_tree</span>(p, <span class="dv">-90</span>)</span>
<span id="cb223-24"><a href="chapter10.html#cb223-24"></a></span>
<span id="cb223-25"><a href="chapter10.html#cb223-25"></a>p &lt;-<span class="st"> </span>p <span class="op">+</span></span>
<span id="cb223-26"><a href="chapter10.html#cb223-26"></a><span class="st">     </span><span class="kw">geom_fruit</span>(</span>
<span id="cb223-27"><a href="chapter10.html#cb223-27"></a>         <span class="dt">data=</span>melt_simple,</span>
<span id="cb223-28"><a href="chapter10.html#cb223-28"></a>         <span class="dt">geom=</span>geom_boxplot,</span>
<span id="cb223-29"><a href="chapter10.html#cb223-29"></a>         <span class="dt">mapping =</span> <span class="kw">aes</span>(</span>
<span id="cb223-30"><a href="chapter10.html#cb223-30"></a>                     <span class="dt">y=</span>OTU,</span>
<span id="cb223-31"><a href="chapter10.html#cb223-31"></a>                     <span class="dt">x=</span>val,</span>
<span id="cb223-32"><a href="chapter10.html#cb223-32"></a>                     <span class="dt">group=</span>label,</span>
<span id="cb223-33"><a href="chapter10.html#cb223-33"></a>                     <span class="dt">fill=</span>Phylum,</span>
<span id="cb223-34"><a href="chapter10.html#cb223-34"></a>                   ),</span>
<span id="cb223-35"><a href="chapter10.html#cb223-35"></a>         <span class="dt">size=</span>.<span class="dv">2</span>,</span>
<span id="cb223-36"><a href="chapter10.html#cb223-36"></a>         <span class="dt">outlier.size=</span><span class="fl">0.5</span>,</span>
<span id="cb223-37"><a href="chapter10.html#cb223-37"></a>         <span class="dt">outlier.stroke=</span><span class="fl">0.08</span>,</span>
<span id="cb223-38"><a href="chapter10.html#cb223-38"></a>         <span class="dt">outlier.shape=</span><span class="dv">21</span>,</span>
<span id="cb223-39"><a href="chapter10.html#cb223-39"></a>         <span class="dt">axis.params=</span><span class="kw">list</span>(</span>
<span id="cb223-40"><a href="chapter10.html#cb223-40"></a>                         <span class="dt">axis       =</span> <span class="st">&quot;x&quot;</span>,</span>
<span id="cb223-41"><a href="chapter10.html#cb223-41"></a>                         <span class="dt">text.size  =</span> <span class="fl">1.8</span>,</span>
<span id="cb223-42"><a href="chapter10.html#cb223-42"></a>                         <span class="dt">hjust      =</span> <span class="dv">1</span>,</span>
<span id="cb223-43"><a href="chapter10.html#cb223-43"></a>                         <span class="dt">vjust      =</span> <span class="fl">0.5</span>,</span>
<span id="cb223-44"><a href="chapter10.html#cb223-44"></a>                         <span class="dt">nbreak     =</span> <span class="dv">3</span>,</span>
<span id="cb223-45"><a href="chapter10.html#cb223-45"></a>                     ),</span>
<span id="cb223-46"><a href="chapter10.html#cb223-46"></a>         <span class="dt">grid.params=</span><span class="kw">list</span>()</span>
<span id="cb223-47"><a href="chapter10.html#cb223-47"></a>     ) </span>
<span id="cb223-48"><a href="chapter10.html#cb223-48"></a>     </span>
<span id="cb223-49"><a href="chapter10.html#cb223-49"></a>p &lt;-<span class="st"> </span>p <span class="op">+</span></span>
<span id="cb223-50"><a href="chapter10.html#cb223-50"></a><span class="st">     </span><span class="kw">scale_fill_discrete</span>(</span>
<span id="cb223-51"><a href="chapter10.html#cb223-51"></a>         <span class="dt">name=</span><span class="st">&quot;Phyla&quot;</span>,</span>
<span id="cb223-52"><a href="chapter10.html#cb223-52"></a>         <span class="dt">guide=</span><span class="kw">guide_legend</span>(<span class="dt">keywidth=</span><span class="fl">0.8</span>, <span class="dt">keyheight=</span><span class="fl">0.8</span>, <span class="dt">ncol=</span><span class="dv">1</span>)</span>
<span id="cb223-53"><a href="chapter10.html#cb223-53"></a>     ) <span class="op">+</span></span>
<span id="cb223-54"><a href="chapter10.html#cb223-54"></a><span class="st">     </span><span class="kw">theme</span>(</span>
<span id="cb223-55"><a href="chapter10.html#cb223-55"></a>         <span class="dt">legend.title=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">9</span>), <span class="co"># The title of legend </span></span>
<span id="cb223-56"><a href="chapter10.html#cb223-56"></a>         <span class="dt">legend.text=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">7</span>) <span class="co"># The label text of legend, the sizes should be adjust with dpi.</span></span>
<span id="cb223-57"><a href="chapter10.html#cb223-57"></a>     )</span>
<span id="cb223-58"><a href="chapter10.html#cb223-58"></a>p</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:psbox"></span>
<img src="treedata_files/figure-html/psbox-1.svg" alt="Phylogenetic tree with OTU abundance distribution." width="864"  />
<p class="caption">
Figure 10.1: <strong>Phylogenetic tree with OTU abundance distribution</strong>.
</p>
</div>
<p>This example uses microbiome data that provided in <code>phyloseq</code> package and boxplot is employed to visualize species abundance data. The <code>geom_fruit</code> layer automatically re-arranges the abundance data according to the circular tree structure, visualizes the data using the specify <code>geom</code> function.</p>
</div>
<div id="aligning-multiple-graphs-to-the-tree-for-multi-dimensional-data" class="section level2" number="10.3">
<h2><span class="header-section-number">10.3</span> Aligning multiple graphs to the tree for multi-dimensional data</h2>
<p>Circular layout is efficient layout to show the phylogenetic tree and multi-dimensional data. The continuous dataset can be displayed using heat map, bar plot, box plot or dot plot etc. This example reproduce Fig.2 of <span class="citation">(Morgan, Segata, and Huttenhower <a href="#ref-morgan2013HMP" role="doc-biblioref">2013</a>)</span>. The data is provided by GraPhlAn <span class="citation">(Asnicar et al. <a href="#ref-GraPhlAn" role="doc-biblioref">2015</a>)</span>, which contained the relative abundance of microbiome at different body sites. This example demonstrates the abilities of adding multiple layers (dot plot, heat map and bar plot) created with continuous data to a specific panel, and the attributes of tip point also can be extracted to map Figure <a href="chapter10.html#fig:HMPplot">10.2</a>. And the tree in <code>geom_fruit</code> can be fully annotated with multiple layers (high light, clade labels <em>etc</em>).</p>


<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="chapter10.html#cb224-1"></a><span class="kw">library</span>(ggtreeExtra)</span>
<span id="cb224-2"><a href="chapter10.html#cb224-2"></a><span class="kw">library</span>(ggtree)</span>
<span id="cb224-3"><a href="chapter10.html#cb224-3"></a><span class="kw">library</span>(treeio)</span>
<span id="cb224-4"><a href="chapter10.html#cb224-4"></a><span class="kw">library</span>(tidytree)</span>
<span id="cb224-5"><a href="chapter10.html#cb224-5"></a><span class="kw">library</span>(ggstar)</span>
<span id="cb224-6"><a href="chapter10.html#cb224-6"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb224-7"><a href="chapter10.html#cb224-7"></a><span class="kw">library</span>(ggnewscale)</span>
<span id="cb224-8"><a href="chapter10.html#cb224-8"></a></span>
<span id="cb224-9"><a href="chapter10.html#cb224-9"></a>tree &lt;-<span class="st"> </span><span class="kw">read.tree</span>(<span class="st">&quot;data/HMP_tree/hmptree.nwk&quot;</span>)</span>
<span id="cb224-10"><a href="chapter10.html#cb224-10"></a><span class="co"># the abundance and types of microbes</span></span>
<span id="cb224-11"><a href="chapter10.html#cb224-11"></a>dat1 &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/HMP_tree/tippoint_attr.csv&quot;</span>)</span>
<span id="cb224-12"><a href="chapter10.html#cb224-12"></a><span class="co"># the abundance of microbes at different body sites.</span></span>
<span id="cb224-13"><a href="chapter10.html#cb224-13"></a>dat2 &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/HMP_tree/ringheatmap_attr.csv&quot;</span>)</span>
<span id="cb224-14"><a href="chapter10.html#cb224-14"></a><span class="co"># the abundance of microbes at the body sites of greatest prevalence.</span></span>
<span id="cb224-15"><a href="chapter10.html#cb224-15"></a>dat3 &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/HMP_tree/barplot_attr.csv&quot;</span>)</span>
<span id="cb224-16"><a href="chapter10.html#cb224-16"></a></span>
<span id="cb224-17"><a href="chapter10.html#cb224-17"></a><span class="co"># adjust the order</span></span>
<span id="cb224-18"><a href="chapter10.html#cb224-18"></a>dat2<span class="op">$</span>Sites &lt;-<span class="st"> </span><span class="kw">factor</span>(dat2<span class="op">$</span>Sites, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;Stool (prevalence)&quot;</span>, <span class="st">&quot;Cheek (prevalence)&quot;</span>,</span>
<span id="cb224-19"><a href="chapter10.html#cb224-19"></a>                                          <span class="st">&quot;Plaque (prevalence)&quot;</span>,<span class="st">&quot;Tongue (prevalence)&quot;</span>,</span>
<span id="cb224-20"><a href="chapter10.html#cb224-20"></a>                                          <span class="st">&quot;Nose (prevalence)&quot;</span>, <span class="st">&quot;Vagina (prevalence)&quot;</span>,</span>
<span id="cb224-21"><a href="chapter10.html#cb224-21"></a>                                          <span class="st">&quot;Skin (prevalence)&quot;</span>))</span>
<span id="cb224-22"><a href="chapter10.html#cb224-22"></a>dat3<span class="op">$</span>Sites &lt;-<span class="st"> </span><span class="kw">factor</span>(dat3<span class="op">$</span>Sites, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;Stool (prevalence)&quot;</span>, <span class="st">&quot;Cheek (prevalence)&quot;</span>,</span>
<span id="cb224-23"><a href="chapter10.html#cb224-23"></a>                                          <span class="st">&quot;Plaque (prevalence)&quot;</span>, <span class="st">&quot;Tongue (prevalence)&quot;</span>,</span>
<span id="cb224-24"><a href="chapter10.html#cb224-24"></a>                                          <span class="st">&quot;Nose (prevalence)&quot;</span>, <span class="st">&quot;Vagina (prevalence)&quot;</span>,</span>
<span id="cb224-25"><a href="chapter10.html#cb224-25"></a>                                          <span class="st">&quot;Skin (prevalence)&quot;</span>))</span>
<span id="cb224-26"><a href="chapter10.html#cb224-26"></a><span class="co"># extract the clade label information. Because some nodes of tree are annotated to genera,</span></span>
<span id="cb224-27"><a href="chapter10.html#cb224-27"></a><span class="co"># which can be displayed with high light using ggtree.</span></span>
<span id="cb224-28"><a href="chapter10.html#cb224-28"></a>nodeids &lt;-<span class="st"> </span><span class="kw">nodeid</span>(tree, tree<span class="op">$</span>node.label[<span class="kw">nchar</span>(tree<span class="op">$</span>node.label)<span class="op">&gt;</span><span class="dv">4</span>])</span>
<span id="cb224-29"><a href="chapter10.html#cb224-29"></a>nodedf &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">node=</span>nodeids)</span>
<span id="cb224-30"><a href="chapter10.html#cb224-30"></a>nodelab &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;[</span><span class="ch">\\</span><span class="st">.0-9]&quot;</span>, <span class="st">&quot;&quot;</span>, tree<span class="op">$</span>node.label[<span class="kw">nchar</span>(tree<span class="op">$</span>node.label)<span class="op">&gt;</span><span class="dv">4</span>])</span>
<span id="cb224-31"><a href="chapter10.html#cb224-31"></a><span class="co"># The layers of clade and hightlight</span></span>
<span id="cb224-32"><a href="chapter10.html#cb224-32"></a>poslist &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">1.6</span>, <span class="fl">1.4</span>, <span class="fl">1.6</span>, <span class="fl">0.8</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">1.6</span>, <span class="fl">1.6</span>, <span class="fl">1.2</span>, <span class="fl">0.4</span>,</span>
<span id="cb224-33"><a href="chapter10.html#cb224-33"></a>             <span class="fl">1.2</span>, <span class="fl">1.8</span>, <span class="fl">0.3</span>, <span class="fl">0.8</span>, <span class="fl">0.4</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.4</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>,</span>
<span id="cb224-34"><a href="chapter10.html#cb224-34"></a>             <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.3</span>)</span>
<span id="cb224-35"><a href="chapter10.html#cb224-35"></a>labdf &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">node=</span>nodeids, <span class="dt">label=</span>nodelab, <span class="dt">pos=</span>poslist)</span>
<span id="cb224-36"><a href="chapter10.html#cb224-36"></a></span>
<span id="cb224-37"><a href="chapter10.html#cb224-37"></a><span class="co"># The circular layout tree.</span></span>
<span id="cb224-38"><a href="chapter10.html#cb224-38"></a>p &lt;-<span class="st"> </span><span class="kw">ggtree</span>(tree, <span class="dt">layout=</span><span class="st">&quot;fan&quot;</span>, <span class="dt">size=</span><span class="fl">0.15</span>, <span class="dt">open.angle=</span><span class="dv">5</span>) <span class="op">+</span></span>
<span id="cb224-39"><a href="chapter10.html#cb224-39"></a><span class="st">     </span><span class="kw">geom_hilight</span>(<span class="dt">data=</span>nodedf, <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">node=</span>node),</span>
<span id="cb224-40"><a href="chapter10.html#cb224-40"></a>                  <span class="dt">extendto=</span><span class="fl">6.8</span>, <span class="dt">alpha=</span><span class="fl">0.3</span>, <span class="dt">fill=</span><span class="st">&quot;grey&quot;</span>, <span class="dt">color=</span><span class="st">&quot;grey50&quot;</span>,</span>
<span id="cb224-41"><a href="chapter10.html#cb224-41"></a>                  <span class="dt">size=</span><span class="fl">0.05</span>) <span class="op">+</span></span>
<span id="cb224-42"><a href="chapter10.html#cb224-42"></a><span class="st">     </span><span class="kw">geom_cladelab</span>(<span class="dt">data=</span>labdf, </span>
<span id="cb224-43"><a href="chapter10.html#cb224-43"></a>                   <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">node=</span>node, </span>
<span id="cb224-44"><a href="chapter10.html#cb224-44"></a>                               <span class="dt">label=</span>label,</span>
<span id="cb224-45"><a href="chapter10.html#cb224-45"></a>                               <span class="dt">offset.text=</span>pos),</span>
<span id="cb224-46"><a href="chapter10.html#cb224-46"></a>                   <span class="dt">hjust=</span><span class="fl">0.5</span>,</span>
<span id="cb224-47"><a href="chapter10.html#cb224-47"></a>                   <span class="dt">angle=</span><span class="st">&quot;auto&quot;</span>,</span>
<span id="cb224-48"><a href="chapter10.html#cb224-48"></a>                   <span class="dt">barsize=</span><span class="ot">NA</span>,</span>
<span id="cb224-49"><a href="chapter10.html#cb224-49"></a>                   <span class="dt">horizontal=</span><span class="ot">FALSE</span>, </span>
<span id="cb224-50"><a href="chapter10.html#cb224-50"></a>                   <span class="dt">fontsize=</span><span class="fl">1.4</span>,</span>
<span id="cb224-51"><a href="chapter10.html#cb224-51"></a>                   <span class="dt">fontface=</span><span class="st">&quot;italic&quot;</span></span>
<span id="cb224-52"><a href="chapter10.html#cb224-52"></a>                   )</span>
<span id="cb224-53"><a href="chapter10.html#cb224-53"></a></span>
<span id="cb224-54"><a href="chapter10.html#cb224-54"></a>p &lt;-<span class="st"> </span>p <span class="op">%&lt;+%</span><span class="st"> </span>dat1 <span class="op">+</span><span class="st"> </span><span class="kw">geom_fruit</span>(<span class="dt">geom=</span>geom_star,</span>
<span id="cb224-55"><a href="chapter10.html#cb224-55"></a>                              <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">fill=</span>Phylum, <span class="dt">starshape=</span>Type, <span class="dt">size=</span>Size),</span>
<span id="cb224-56"><a href="chapter10.html#cb224-56"></a>                              <span class="dt">position=</span><span class="st">&quot;identity&quot;</span>,<span class="dt">starstroke=</span><span class="fl">0.1</span>)<span class="op">+</span></span>
<span id="cb224-57"><a href="chapter10.html#cb224-57"></a><span class="st">         </span><span class="kw">scale_fill_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="st">&quot;#FFC125&quot;</span>,<span class="st">&quot;#87CEFA&quot;</span>,<span class="st">&quot;#7B68EE&quot;</span>,<span class="st">&quot;#808080&quot;</span>,<span class="st">&quot;#800080&quot;</span>,</span>
<span id="cb224-58"><a href="chapter10.html#cb224-58"></a>                                    <span class="st">&quot;#9ACD32&quot;</span>,<span class="st">&quot;#D15FEE&quot;</span>,<span class="st">&quot;#FFC0CB&quot;</span>,<span class="st">&quot;#EE6A50&quot;</span>,<span class="st">&quot;#8DEEEE&quot;</span>,</span>
<span id="cb224-59"><a href="chapter10.html#cb224-59"></a>                                    <span class="st">&quot;#006400&quot;</span>,<span class="st">&quot;#800000&quot;</span>,<span class="st">&quot;#B0171F&quot;</span>,<span class="st">&quot;#191970&quot;</span>),</span>
<span id="cb224-60"><a href="chapter10.html#cb224-60"></a>                           <span class="dt">guide=</span><span class="kw">guide_legend</span>(<span class="dt">keywidth =</span> <span class="fl">0.5</span>, <span class="dt">keyheight =</span> <span class="fl">0.5</span>, <span class="dt">order=</span><span class="dv">1</span>,</span>
<span id="cb224-61"><a href="chapter10.html#cb224-61"></a>                                              <span class="dt">override.aes=</span><span class="kw">list</span>(<span class="dt">starshape=</span><span class="dv">15</span>)),</span>
<span id="cb224-62"><a href="chapter10.html#cb224-62"></a>                           <span class="dt">na.translate=</span><span class="ot">FALSE</span>)<span class="op">+</span></span>
<span id="cb224-63"><a href="chapter10.html#cb224-63"></a><span class="st">         </span><span class="kw">scale_starshape_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="dv">15</span>, <span class="dv">1</span>),</span>
<span id="cb224-64"><a href="chapter10.html#cb224-64"></a>                                <span class="dt">guide=</span><span class="kw">guide_legend</span>(<span class="dt">keywidth =</span> <span class="fl">0.5</span>, <span class="dt">keyheight =</span> <span class="fl">0.5</span>, <span class="dt">order=</span><span class="dv">2</span>),</span>
<span id="cb224-65"><a href="chapter10.html#cb224-65"></a>                                <span class="dt">na.translate=</span><span class="ot">FALSE</span>)<span class="op">+</span></span>
<span id="cb224-66"><a href="chapter10.html#cb224-66"></a><span class="st">         </span><span class="kw">scale_size_continuous</span>(<span class="dt">range =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">2.5</span>),</span>
<span id="cb224-67"><a href="chapter10.html#cb224-67"></a>                               <span class="dt">guide =</span> <span class="kw">guide_legend</span>(<span class="dt">keywidth =</span> <span class="fl">0.5</span>, <span class="dt">keyheight =</span> <span class="fl">0.5</span>, <span class="dt">order=</span><span class="dv">3</span>,</span>
<span id="cb224-68"><a href="chapter10.html#cb224-68"></a>                                                    <span class="dt">override.aes=</span><span class="kw">list</span>(<span class="dt">starshape=</span><span class="dv">15</span>)))<span class="op">+</span></span>
<span id="cb224-69"><a href="chapter10.html#cb224-69"></a><span class="st">         </span><span class="kw">new_scale_fill</span>()<span class="op">+</span></span>
<span id="cb224-70"><a href="chapter10.html#cb224-70"></a><span class="st">         </span><span class="kw">geom_fruit</span>(<span class="dt">data=</span>dat2, <span class="dt">geom=</span>geom_tile,</span>
<span id="cb224-71"><a href="chapter10.html#cb224-71"></a>                    <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">y=</span>ID, <span class="dt">x=</span>Sites, <span class="dt">alpha=</span>Abundance, <span class="dt">fill=</span>Sites),</span>
<span id="cb224-72"><a href="chapter10.html#cb224-72"></a>                    <span class="dt">color =</span> <span class="st">&quot;grey50&quot;</span>, <span class="dt">offset =</span> <span class="fl">0.04</span>,<span class="dt">size =</span> <span class="fl">0.02</span>)<span class="op">+</span></span>
<span id="cb224-73"><a href="chapter10.html#cb224-73"></a><span class="st">         </span><span class="kw">scale_alpha_continuous</span>(<span class="dt">range=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb224-74"><a href="chapter10.html#cb224-74"></a>                             <span class="dt">guide=</span><span class="kw">guide_legend</span>(<span class="dt">keywidth =</span> <span class="fl">0.3</span>, <span class="dt">keyheight =</span> <span class="fl">0.3</span>, <span class="dt">order=</span><span class="dv">5</span>)) <span class="op">+</span></span>
<span id="cb224-75"><a href="chapter10.html#cb224-75"></a><span class="st">         </span><span class="kw">geom_fruit</span>(<span class="dt">data=</span>dat3, <span class="dt">geom=</span>geom_bar,</span>
<span id="cb224-76"><a href="chapter10.html#cb224-76"></a>                    <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">y=</span>ID, <span class="dt">x=</span>HigherAbundance, <span class="dt">fill=</span>Sites),</span>
<span id="cb224-77"><a href="chapter10.html#cb224-77"></a>                    <span class="dt">pwidth=</span><span class="fl">0.38</span>, </span>
<span id="cb224-78"><a href="chapter10.html#cb224-78"></a>                    <span class="dt">orientation=</span><span class="st">&quot;y&quot;</span>, </span>
<span id="cb224-79"><a href="chapter10.html#cb224-79"></a>                    <span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>,</span>
<span id="cb224-80"><a href="chapter10.html#cb224-80"></a>         )<span class="op">+</span></span>
<span id="cb224-81"><a href="chapter10.html#cb224-81"></a><span class="st">         </span><span class="kw">scale_fill_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="st">&quot;#0000FF&quot;</span>,<span class="st">&quot;#FFA500&quot;</span>,<span class="st">&quot;#FF0000&quot;</span>,<span class="st">&quot;#800000&quot;</span>,</span>
<span id="cb224-82"><a href="chapter10.html#cb224-82"></a>                                    <span class="st">&quot;#006400&quot;</span>,<span class="st">&quot;#800080&quot;</span>,<span class="st">&quot;#696969&quot;</span>),</span>
<span id="cb224-83"><a href="chapter10.html#cb224-83"></a>                           <span class="dt">guide=</span><span class="kw">guide_legend</span>(<span class="dt">keywidth =</span> <span class="fl">0.3</span>, <span class="dt">keyheight =</span> <span class="fl">0.3</span>, <span class="dt">order=</span><span class="dv">4</span>))<span class="op">+</span></span>
<span id="cb224-84"><a href="chapter10.html#cb224-84"></a><span class="st">         </span><span class="kw">geom_treescale</span>(<span class="dt">fontsize=</span><span class="dv">2</span>, <span class="dt">linesize=</span><span class="fl">0.3</span>, <span class="dt">x=</span><span class="fl">4.9</span>, <span class="dt">y=</span><span class="fl">0.1</span>) <span class="op">+</span></span>
<span id="cb224-85"><a href="chapter10.html#cb224-85"></a><span class="st">         </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="kw">c</span>(<span class="fl">0.93</span>, <span class="fl">0.5</span>),</span>
<span id="cb224-86"><a href="chapter10.html#cb224-86"></a>               <span class="dt">legend.background=</span><span class="kw">element_rect</span>(<span class="dt">fill=</span><span class="ot">NA</span>),</span>
<span id="cb224-87"><a href="chapter10.html#cb224-87"></a>               <span class="dt">legend.title=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="fl">6.5</span>),</span>
<span id="cb224-88"><a href="chapter10.html#cb224-88"></a>               <span class="dt">legend.text=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="fl">4.5</span>),</span>
<span id="cb224-89"><a href="chapter10.html#cb224-89"></a>               <span class="dt">legend.spacing.y =</span> <span class="kw">unit</span>(<span class="fl">0.02</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb224-90"><a href="chapter10.html#cb224-90"></a>             )</span>
<span id="cb224-91"><a href="chapter10.html#cb224-91"></a>p</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:HMPplot"></span>
<img src="treedata_files/figure-html/HMPplot-1.svg" alt="Phylogenetic tree about the abundance of microbes at different sites of human." width="672"  />
<p class="caption">
Figure 10.2: <strong>Phylogenetic tree about the abundance of microbes at different sites of human</strong>.
</p>
</div>
<p>The shape of tip labels indicated the commensal microbes or potential pathogens. The transparency of heat map indicates the abundance of microbes, and colors of heat map indicate the different sites of human. The bar plot indicates the relative abundance at body site of the most abundance. The node labels contain taxonomy information in this example, so it can be highlight using <code>geom_hilight</code>. The datasets disabled with heat map and bar plot are the format of specific <code>geom</code> of <code>ggplot2</code>. If you have short table format datasets, you can use <code>reshape2::melt()</code> or <code>tidyr::pivot_longer()</code> to convert them.</p>
</div>
<div id="api-to-link-ggtree-and-ggplot2." class="section level2" number="10.4">
<h2><span class="header-section-number">10.4</span> API to link <em>ggtree</em> and <em>ggplot2</em>.</h2>
<p>As we known, <em>ggplot2</em> is a general tool for visualization in many fields. <em>ggtree</em> is also a general tool for visualization of phylogenetic trees or other tree-like structures. So it can be applied in many research fields, such as infectious disease epidemiology, metagenome, population genetics, evolutionary biology and ecology. <a href="http://bioconductor.org/packages/ggtreeExtra">ggtreeExtra</a> provides <code>geom_fruit</code>, an application programming interface to link <a href="http://bioconductor.org/packages/ggtree">ggtree</a><span class="citation">(Yu et al. <a href="#ref-yu_ggtree:_2017" role="doc-biblioref">2017</a>)</span> and <a href="https://CRAN.R-project.org/package=ggplot2">ggplot2</a> <span class="citation">(Wickham <a href="#ref-wickham_ggplot2_2009" role="doc-biblioref">2009</a>)</span>. So it also can be applied in many fields. The some cases of metagenome research has been showed in Figure <a href="chapter10.html#fig:psbox">10.1</a> and Figure <a href="chapter10.html#fig:HMPplot">10.2</a>. In this section, we reproduce the FIG 4 of <span class="citation">(Chow et al. <a href="#ref-Chowe:_2020" role="doc-biblioref">2020</a>)</span> and Fig 1 of <span class="citation">(Wong et al. <a href="#ref-RN46:_2015" role="doc-biblioref">2015</a>)</span> to show that it also can be applied in population genetics. Again, it show that the tree in <code>geom_fruit</code> can be fully annotated with multiple layers (clade group) in Figure <a href="chapter10.html#fig:Caurisplot">10.3</a>.</p>




<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="chapter10.html#cb225-1"></a><span class="kw">library</span>(ggtree)</span>
<span id="cb225-2"><a href="chapter10.html#cb225-2"></a><span class="kw">library</span>(ggtreeExtra)</span>
<span id="cb225-3"><a href="chapter10.html#cb225-3"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb225-4"><a href="chapter10.html#cb225-4"></a><span class="kw">library</span>(ggnewscale)</span>
<span id="cb225-5"><a href="chapter10.html#cb225-5"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb225-6"><a href="chapter10.html#cb225-6"></a><span class="kw">library</span>(tidytree)</span>
<span id="cb225-7"><a href="chapter10.html#cb225-7"></a><span class="kw">library</span>(ggstar)</span>
<span id="cb225-8"><a href="chapter10.html#cb225-8"></a></span>
<span id="cb225-9"><a href="chapter10.html#cb225-9"></a>dat &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/microreact/Candida_auris/microreact-project-Candidaauris-data.csv&quot;</span>)</span>
<span id="cb225-10"><a href="chapter10.html#cb225-10"></a>tr &lt;-<span class="st"> </span><span class="kw">read.tree</span>(<span class="st">&quot;data/microreact/Candida_auris/microreact-project-Candidaauris-tree.nwk&quot;</span>)</span>
<span id="cb225-11"><a href="chapter10.html#cb225-11"></a></span>
<span id="cb225-12"><a href="chapter10.html#cb225-12"></a>countries &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Canada&quot;</span>, <span class="st">&quot;United States&quot;</span>,</span>
<span id="cb225-13"><a href="chapter10.html#cb225-13"></a>               <span class="st">&quot;Colombia&quot;</span>, <span class="st">&quot;Panama&quot;</span>,</span>
<span id="cb225-14"><a href="chapter10.html#cb225-14"></a>               <span class="st">&quot;Venezuela&quot;</span>, <span class="st">&quot;France&quot;</span>,</span>
<span id="cb225-15"><a href="chapter10.html#cb225-15"></a>               <span class="st">&quot;Germany&quot;</span>, <span class="st">&quot;Spain&quot;</span>,</span>
<span id="cb225-16"><a href="chapter10.html#cb225-16"></a>               <span class="st">&quot;UK&quot;</span>, <span class="st">&quot;India&quot;</span>,</span>
<span id="cb225-17"><a href="chapter10.html#cb225-17"></a>               <span class="st">&quot;Israel&quot;</span>, <span class="st">&quot;Pakistan&quot;</span>,</span>
<span id="cb225-18"><a href="chapter10.html#cb225-18"></a>               <span class="st">&quot;Saudi Arabia&quot;</span>, <span class="st">&quot;United Arab Emirates&quot;</span>,</span>
<span id="cb225-19"><a href="chapter10.html#cb225-19"></a>               <span class="st">&quot;Kenya&quot;</span>, <span class="st">&quot;South Africa&quot;</span>,</span>
<span id="cb225-20"><a href="chapter10.html#cb225-20"></a>               <span class="st">&quot;Japan&quot;</span>, <span class="st">&quot;South Korea&quot;</span>,</span>
<span id="cb225-21"><a href="chapter10.html#cb225-21"></a>               <span class="st">&quot;Australia&quot;</span>)</span>
<span id="cb225-22"><a href="chapter10.html#cb225-22"></a><span class="co"># For the tip points</span></span>
<span id="cb225-23"><a href="chapter10.html#cb225-23"></a>dat1 &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;COUNTRY&quot;</span>, <span class="st">&quot;COUNTRY__colour&quot;</span>))</span>
<span id="cb225-24"><a href="chapter10.html#cb225-24"></a>dat1<span class="op">$</span>COUNTRY &lt;-<span class="st"> </span><span class="kw">factor</span>(dat1<span class="op">$</span>COUNTRY, <span class="dt">levels=</span>countries)</span>
<span id="cb225-25"><a href="chapter10.html#cb225-25"></a>COUNTRYcolors &lt;-<span class="st"> </span>dat1[<span class="kw">match</span>(countries,dat<span class="op">$</span>COUNTRY),<span class="st">&quot;COUNTRY__colour&quot;</span>]</span>
<span id="cb225-26"><a href="chapter10.html#cb225-26"></a></span>
<span id="cb225-27"><a href="chapter10.html#cb225-27"></a><span class="co"># For the heatmap layer</span></span>
<span id="cb225-28"><a href="chapter10.html#cb225-28"></a>dat2 &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;FCZ&quot;</span>, <span class="st">&quot;AMB&quot;</span>, <span class="st">&quot;MCF&quot;</span>))</span>
<span id="cb225-29"><a href="chapter10.html#cb225-29"></a>dat2 &lt;-<span class="st"> </span>reshape2<span class="op">::</span><span class="kw">melt</span>(dat2,<span class="dt">id=</span><span class="st">&quot;ID&quot;</span>, <span class="dt">variable.name=</span><span class="st">&quot;Antifungal&quot;</span>, <span class="dt">value.name=</span><span class="st">&quot;type&quot;</span>)</span>
<span id="cb225-30"><a href="chapter10.html#cb225-30"></a>dat2<span class="op">$</span>type &lt;-<span class="st"> </span><span class="kw">paste</span>(dat2<span class="op">$</span>Antifungal, dat2<span class="op">$</span>type)</span>
<span id="cb225-31"><a href="chapter10.html#cb225-31"></a>dat2<span class="op">$</span>type &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(dat2<span class="op">$</span>type,</span>
<span id="cb225-32"><a href="chapter10.html#cb225-32"></a>                           <span class="cf">function</span>(x)<span class="kw">ifelse</span>(<span class="kw">grepl</span>(<span class="st">&quot;Not_&quot;</span>, x), <span class="st">&quot;Susceptible&quot;</span>, x)))</span>
<span id="cb225-33"><a href="chapter10.html#cb225-33"></a>dat2<span class="op">$</span>Antifungal &lt;-<span class="st"> </span><span class="kw">factor</span>(dat2<span class="op">$</span>Antifungal, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;FCZ&quot;</span>, <span class="st">&quot;AMB&quot;</span>, <span class="st">&quot;MCF&quot;</span>))</span>
<span id="cb225-34"><a href="chapter10.html#cb225-34"></a>dat2<span class="op">$</span>type &lt;-<span class="st"> </span><span class="kw">factor</span>(dat2<span class="op">$</span>type,</span>
<span id="cb225-35"><a href="chapter10.html#cb225-35"></a>                    <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;FCZ Resistant&quot;</span>,</span>
<span id="cb225-36"><a href="chapter10.html#cb225-36"></a>                            <span class="st">&quot;AMB Resistant&quot;</span>,</span>
<span id="cb225-37"><a href="chapter10.html#cb225-37"></a>                            <span class="st">&quot;MCF Resistant&quot;</span>,</span>
<span id="cb225-38"><a href="chapter10.html#cb225-38"></a>                            <span class="st">&quot;Susceptible&quot;</span>))</span>
<span id="cb225-39"><a href="chapter10.html#cb225-39"></a></span>
<span id="cb225-40"><a href="chapter10.html#cb225-40"></a><span class="co"># For the points layer</span></span>
<span id="cb225-41"><a href="chapter10.html#cb225-41"></a>dat3 &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;ERG11&quot;</span>, <span class="st">&quot;FKS1&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb225-42"><a href="chapter10.html#cb225-42"></a><span class="st">        </span>reshape2<span class="op">::</span><span class="kw">melt</span>(<span class="dt">id=</span><span class="st">&quot;ID&quot;</span>, <span class="dt">variable.name=</span><span class="st">&quot;point&quot;</span>, <span class="dt">value.name=</span><span class="st">&quot;mutation&quot;</span>)</span>
<span id="cb225-43"><a href="chapter10.html#cb225-43"></a>dat3<span class="op">$</span>mutation &lt;-<span class="st"> </span><span class="kw">paste</span>(dat3<span class="op">$</span>point, dat3<span class="op">$</span>mutation)</span>
<span id="cb225-44"><a href="chapter10.html#cb225-44"></a>dat3<span class="op">$</span>mutation &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(dat3<span class="op">$</span>mutation, <span class="cf">function</span>(x)<span class="kw">ifelse</span>(<span class="kw">grepl</span>(<span class="st">&quot;WT&quot;</span>,x), <span class="ot">NA</span>,x)))</span>
<span id="cb225-45"><a href="chapter10.html#cb225-45"></a>dat3<span class="op">$</span>mutation &lt;-<span class="st"> </span><span class="kw">factor</span>(dat3<span class="op">$</span>mutation, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;ERG11 Y132F&quot;</span>, <span class="st">&quot;ERG11 K143R&quot;</span>,</span>
<span id="cb225-46"><a href="chapter10.html#cb225-46"></a>                                                <span class="st">&quot;ERG11 F126L&quot;</span>, <span class="st">&quot;FKS1 S639Y/P/F&quot;</span>))</span>
<span id="cb225-47"><a href="chapter10.html#cb225-47"></a></span>
<span id="cb225-48"><a href="chapter10.html#cb225-48"></a><span class="co"># For the clade group</span></span>
<span id="cb225-49"><a href="chapter10.html#cb225-49"></a>dat4 &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;CLADE&quot;</span>))</span>
<span id="cb225-50"><a href="chapter10.html#cb225-50"></a>dat4 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(.<span class="op">~</span>CLADE, dat4, <span class="dt">FUN=</span>paste, <span class="dt">collapse=</span><span class="st">&quot;,&quot;</span>)</span>
<span id="cb225-51"><a href="chapter10.html#cb225-51"></a>clades &lt;-<span class="st"> </span><span class="kw">lapply</span>(dat4<span class="op">$</span>ID, <span class="cf">function</span>(x){<span class="kw">unlist</span>(<span class="kw">strsplit</span>(x,<span class="dt">split=</span><span class="st">&quot;,&quot;</span>))})</span>
<span id="cb225-52"><a href="chapter10.html#cb225-52"></a><span class="kw">names</span>(clades) &lt;-<span class="st"> </span>dat4<span class="op">$</span>CLADE</span>
<span id="cb225-53"><a href="chapter10.html#cb225-53"></a></span>
<span id="cb225-54"><a href="chapter10.html#cb225-54"></a>tr &lt;-<span class="st"> </span><span class="kw">groupOTU</span>(tr, clades, <span class="st">&quot;Clade&quot;</span>)</span>
<span id="cb225-55"><a href="chapter10.html#cb225-55"></a>Clade &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb225-56"><a href="chapter10.html#cb225-56"></a>p &lt;-<span class="st"> </span><span class="kw">ggtree</span>(<span class="dt">tr=</span>tr, <span class="dt">layout=</span><span class="st">&quot;fan&quot;</span>, <span class="dt">open.angle=</span><span class="dv">15</span>, <span class="dt">size=</span><span class="fl">0.2</span>, <span class="kw">aes</span>(<span class="dt">colour=</span>Clade)) <span class="op">+</span></span>
<span id="cb225-57"><a href="chapter10.html#cb225-57"></a><span class="st">     </span><span class="kw">scale_colour_manual</span>(</span>
<span id="cb225-58"><a href="chapter10.html#cb225-58"></a>         <span class="dt">values=</span><span class="kw">c</span>(<span class="st">&quot;black&quot;</span>,<span class="st">&quot;#69B920&quot;</span>,<span class="st">&quot;#9C2E88&quot;</span>,<span class="st">&quot;#F74B00&quot;</span>,<span class="st">&quot;#60C3DB&quot;</span>),</span>
<span id="cb225-59"><a href="chapter10.html#cb225-59"></a>         <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;&quot;</span>,<span class="st">&quot;I&quot;</span>, <span class="st">&quot;II&quot;</span>, <span class="st">&quot;III&quot;</span>, <span class="st">&quot;IV&quot;</span>),</span>
<span id="cb225-60"><a href="chapter10.html#cb225-60"></a>         <span class="dt">guide=</span><span class="kw">guide_legend</span>(<span class="dt">keywidth=</span><span class="fl">0.5</span>,</span>
<span id="cb225-61"><a href="chapter10.html#cb225-61"></a>                            <span class="dt">keyheight=</span><span class="fl">0.5</span>,</span>
<span id="cb225-62"><a href="chapter10.html#cb225-62"></a>                            <span class="dt">order=</span><span class="dv">1</span>,</span>
<span id="cb225-63"><a href="chapter10.html#cb225-63"></a>                            <span class="dt">override.aes=</span><span class="kw">list</span>(<span class="dt">linetype=</span><span class="kw">c</span>(<span class="st">&quot;0&quot;</span>=<span class="ot">NA</span>,</span>
<span id="cb225-64"><a href="chapter10.html#cb225-64"></a>                                                         <span class="st">&quot;Clade1&quot;</span>=<span class="dv">1</span>,</span>
<span id="cb225-65"><a href="chapter10.html#cb225-65"></a>                                                         <span class="st">&quot;Clade2&quot;</span>=<span class="dv">1</span>,</span>
<span id="cb225-66"><a href="chapter10.html#cb225-66"></a>                                                         <span class="st">&quot;Clade3&quot;</span>=<span class="dv">1</span>,</span>
<span id="cb225-67"><a href="chapter10.html#cb225-67"></a>                                                         <span class="st">&quot;Clade4&quot;</span>=<span class="dv">1</span></span>
<span id="cb225-68"><a href="chapter10.html#cb225-68"></a>                                                        )</span>
<span id="cb225-69"><a href="chapter10.html#cb225-69"></a>                                             )</span>
<span id="cb225-70"><a href="chapter10.html#cb225-70"></a>                           )</span>
<span id="cb225-71"><a href="chapter10.html#cb225-71"></a>     ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb225-72"><a href="chapter10.html#cb225-72"></a><span class="st">     </span><span class="kw">new_scale_colour</span>()</span>
<span id="cb225-73"><a href="chapter10.html#cb225-73"></a></span>
<span id="cb225-74"><a href="chapter10.html#cb225-74"></a>p1 &lt;-<span class="st"> </span>p <span class="op">%&lt;+%</span><span class="st"> </span>dat1 <span class="op">+</span></span>
<span id="cb225-75"><a href="chapter10.html#cb225-75"></a><span class="st">     </span><span class="kw">geom_tippoint</span>(<span class="kw">aes</span>(<span class="dt">colour=</span>COUNTRY),</span>
<span id="cb225-76"><a href="chapter10.html#cb225-76"></a>                   <span class="dt">alpha=</span><span class="dv">0</span>) <span class="op">+</span></span>
<span id="cb225-77"><a href="chapter10.html#cb225-77"></a><span class="st">     </span><span class="kw">geom_tiplab</span>(<span class="kw">aes</span>(<span class="dt">colour=</span>COUNTRY),</span>
<span id="cb225-78"><a href="chapter10.html#cb225-78"></a>                   <span class="dt">align=</span><span class="ot">TRUE</span>,</span>
<span id="cb225-79"><a href="chapter10.html#cb225-79"></a>                   <span class="dt">linetype=</span><span class="dv">3</span>,</span>
<span id="cb225-80"><a href="chapter10.html#cb225-80"></a>                   <span class="dt">size=</span><span class="dv">1</span>,</span>
<span id="cb225-81"><a href="chapter10.html#cb225-81"></a>                   <span class="dt">linesize=</span><span class="fl">0.2</span>,</span>
<span id="cb225-82"><a href="chapter10.html#cb225-82"></a>                   <span class="dt">show.legend=</span><span class="ot">FALSE</span></span>
<span id="cb225-83"><a href="chapter10.html#cb225-83"></a>                   ) <span class="op">+</span></span>
<span id="cb225-84"><a href="chapter10.html#cb225-84"></a><span class="st">     </span><span class="kw">scale_colour_manual</span>(</span>
<span id="cb225-85"><a href="chapter10.html#cb225-85"></a>         <span class="dt">name=</span><span class="st">&quot;Country labels&quot;</span>,</span>
<span id="cb225-86"><a href="chapter10.html#cb225-86"></a>         <span class="dt">values=</span>COUNTRYcolors,</span>
<span id="cb225-87"><a href="chapter10.html#cb225-87"></a>         <span class="dt">guide=</span><span class="kw">guide_legend</span>(<span class="dt">keywidth=</span><span class="fl">0.5</span>,</span>
<span id="cb225-88"><a href="chapter10.html#cb225-88"></a>                            <span class="dt">keyheight=</span><span class="fl">0.5</span>,</span>
<span id="cb225-89"><a href="chapter10.html#cb225-89"></a>                            <span class="dt">order=</span><span class="dv">2</span>,</span>
<span id="cb225-90"><a href="chapter10.html#cb225-90"></a>                            <span class="dt">override.aes=</span><span class="kw">list</span>(<span class="dt">size=</span><span class="dv">2</span>,<span class="dt">alpha=</span><span class="dv">1</span>))</span>
<span id="cb225-91"><a href="chapter10.html#cb225-91"></a>     )</span>
<span id="cb225-92"><a href="chapter10.html#cb225-92"></a></span>
<span id="cb225-93"><a href="chapter10.html#cb225-93"></a>p2 &lt;-<span class="st"> </span>p1 <span class="op">+</span></span>
<span id="cb225-94"><a href="chapter10.html#cb225-94"></a><span class="st">      </span><span class="kw">geom_fruit</span>(</span>
<span id="cb225-95"><a href="chapter10.html#cb225-95"></a>          <span class="dt">data=</span>dat2,</span>
<span id="cb225-96"><a href="chapter10.html#cb225-96"></a>          <span class="dt">geom=</span>geom_tile,</span>
<span id="cb225-97"><a href="chapter10.html#cb225-97"></a>          <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x=</span>Antifungal, <span class="dt">y=</span>ID, <span class="dt">fill=</span>type),</span>
<span id="cb225-98"><a href="chapter10.html#cb225-98"></a>          <span class="dt">width=</span><span class="fl">0.1</span>,</span>
<span id="cb225-99"><a href="chapter10.html#cb225-99"></a>          <span class="dt">color=</span><span class="st">&quot;white&quot;</span>,</span>
<span id="cb225-100"><a href="chapter10.html#cb225-100"></a>          <span class="dt">pwidth=</span><span class="fl">0.1</span>,</span>
<span id="cb225-101"><a href="chapter10.html#cb225-101"></a>          <span class="dt">offset=</span><span class="fl">0.15</span></span>
<span id="cb225-102"><a href="chapter10.html#cb225-102"></a>      ) <span class="op">+</span></span>
<span id="cb225-103"><a href="chapter10.html#cb225-103"></a><span class="st">      </span><span class="kw">scale_fill_manual</span>(</span>
<span id="cb225-104"><a href="chapter10.html#cb225-104"></a>           <span class="dt">name=</span><span class="st">&quot;Antifungal susceptibility&quot;</span>,</span>
<span id="cb225-105"><a href="chapter10.html#cb225-105"></a>           <span class="dt">values=</span><span class="kw">c</span>(<span class="st">&quot;#595959&quot;</span>, <span class="st">&quot;#B30000&quot;</span>, <span class="st">&quot;#020099&quot;</span>, <span class="st">&quot;#E6E6E6&quot;</span>),</span>
<span id="cb225-106"><a href="chapter10.html#cb225-106"></a>           <span class="dt">na.translate=</span><span class="ot">FALSE</span>,</span>
<span id="cb225-107"><a href="chapter10.html#cb225-107"></a>           <span class="dt">guide=</span><span class="kw">guide_legend</span>(<span class="dt">keywidth=</span><span class="fl">0.5</span>,</span>
<span id="cb225-108"><a href="chapter10.html#cb225-108"></a>                              <span class="dt">keyheight=</span><span class="fl">0.5</span>,</span>
<span id="cb225-109"><a href="chapter10.html#cb225-109"></a>                              <span class="dt">order=</span><span class="dv">3</span></span>
<span id="cb225-110"><a href="chapter10.html#cb225-110"></a>                             )</span>
<span id="cb225-111"><a href="chapter10.html#cb225-111"></a>      ) <span class="op">+</span></span>
<span id="cb225-112"><a href="chapter10.html#cb225-112"></a><span class="st">      </span><span class="kw">new_scale_fill</span>()</span>
<span id="cb225-113"><a href="chapter10.html#cb225-113"></a></span>
<span id="cb225-114"><a href="chapter10.html#cb225-114"></a>p3 &lt;-<span class="st"> </span>p2 <span class="op">+</span></span>
<span id="cb225-115"><a href="chapter10.html#cb225-115"></a><span class="st">      </span><span class="kw">geom_fruit</span>(</span>
<span id="cb225-116"><a href="chapter10.html#cb225-116"></a>          <span class="dt">data=</span>dat3,</span>
<span id="cb225-117"><a href="chapter10.html#cb225-117"></a>          <span class="dt">geom=</span>geom_star,</span>
<span id="cb225-118"><a href="chapter10.html#cb225-118"></a>          <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x=</span>mutation, <span class="dt">y=</span>ID, <span class="dt">fill=</span>mutation, <span class="dt">starshape=</span>point),</span>
<span id="cb225-119"><a href="chapter10.html#cb225-119"></a>          <span class="dt">size=</span><span class="dv">1</span>,</span>
<span id="cb225-120"><a href="chapter10.html#cb225-120"></a>          <span class="dt">starstroke=</span><span class="dv">0</span>,</span>
<span id="cb225-121"><a href="chapter10.html#cb225-121"></a>          <span class="dt">pwidth=</span><span class="fl">0.1</span>,</span>
<span id="cb225-122"><a href="chapter10.html#cb225-122"></a>          <span class="dt">inherit.aes =</span> <span class="ot">FALSE</span>,</span>
<span id="cb225-123"><a href="chapter10.html#cb225-123"></a>          <span class="dt">grid.params=</span><span class="kw">list</span>(</span>
<span id="cb225-124"><a href="chapter10.html#cb225-124"></a>                          <span class="dt">linetype=</span><span class="dv">3</span>,</span>
<span id="cb225-125"><a href="chapter10.html#cb225-125"></a>                          <span class="dt">size=</span><span class="fl">0.2</span></span>
<span id="cb225-126"><a href="chapter10.html#cb225-126"></a>                      )</span>
<span id="cb225-127"><a href="chapter10.html#cb225-127"></a></span>
<span id="cb225-128"><a href="chapter10.html#cb225-128"></a>      ) <span class="op">+</span></span>
<span id="cb225-129"><a href="chapter10.html#cb225-129"></a><span class="st">      </span><span class="kw">scale_fill_manual</span>(</span>
<span id="cb225-130"><a href="chapter10.html#cb225-130"></a>          <span class="dt">name=</span><span class="st">&quot;Point mutations&quot;</span>,</span>
<span id="cb225-131"><a href="chapter10.html#cb225-131"></a>          <span class="dt">values=</span><span class="kw">c</span>(<span class="st">&quot;#329901&quot;</span>, <span class="st">&quot;#0600FF&quot;</span>, <span class="st">&quot;#FF0100&quot;</span>, <span class="st">&quot;#9900CC&quot;</span>),</span>
<span id="cb225-132"><a href="chapter10.html#cb225-132"></a>          <span class="dt">guide=</span><span class="kw">guide_legend</span>(<span class="dt">keywidth=</span><span class="fl">0.5</span>, <span class="dt">keyheight=</span><span class="fl">0.5</span>, <span class="dt">order=</span><span class="dv">4</span>,</span>
<span id="cb225-133"><a href="chapter10.html#cb225-133"></a>                             <span class="dt">override.aes=</span><span class="kw">list</span>(<span class="dt">starshape=</span><span class="kw">c</span>(<span class="st">&quot;ERG11 Y132F&quot;</span>=<span class="dv">15</span>,</span>
<span id="cb225-134"><a href="chapter10.html#cb225-134"></a>                                                           <span class="st">&quot;ERG11 K143R&quot;</span>=<span class="dv">15</span>,</span>
<span id="cb225-135"><a href="chapter10.html#cb225-135"></a>                                                           <span class="st">&quot;ERG11 F126L&quot;</span>=<span class="dv">15</span>,</span>
<span id="cb225-136"><a href="chapter10.html#cb225-136"></a>                                                           <span class="st">&quot;FKS1 S639Y/P/F&quot;</span>=<span class="dv">1</span>),</span>
<span id="cb225-137"><a href="chapter10.html#cb225-137"></a>                                               <span class="dt">size=</span><span class="dv">2</span>)</span>
<span id="cb225-138"><a href="chapter10.html#cb225-138"></a>                            ),</span>
<span id="cb225-139"><a href="chapter10.html#cb225-139"></a>          <span class="dt">na.translate=</span><span class="ot">FALSE</span>,</span>
<span id="cb225-140"><a href="chapter10.html#cb225-140"></a>      ) <span class="op">+</span></span>
<span id="cb225-141"><a href="chapter10.html#cb225-141"></a><span class="st">      </span><span class="kw">scale_starshape_manual</span>(</span>
<span id="cb225-142"><a href="chapter10.html#cb225-142"></a>          <span class="dt">values=</span><span class="kw">c</span>(<span class="dv">15</span>, <span class="dv">1</span>),</span>
<span id="cb225-143"><a href="chapter10.html#cb225-143"></a>          <span class="dt">guide=</span><span class="st">&quot;none&quot;</span></span>
<span id="cb225-144"><a href="chapter10.html#cb225-144"></a>      ) <span class="op">+</span></span>
<span id="cb225-145"><a href="chapter10.html#cb225-145"></a><span class="st">      </span><span class="kw">theme</span>(</span>
<span id="cb225-146"><a href="chapter10.html#cb225-146"></a>          <span class="dt">legend.background=</span><span class="kw">element_rect</span>(<span class="dt">fill=</span><span class="ot">NA</span>),</span>
<span id="cb225-147"><a href="chapter10.html#cb225-147"></a>          <span class="dt">legend.title=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">7</span>), <span class="co"># The size should be adjusted with different devout.</span></span>
<span id="cb225-148"><a href="chapter10.html#cb225-148"></a>          <span class="dt">legend.text=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="fl">5.5</span>),</span>
<span id="cb225-149"><a href="chapter10.html#cb225-149"></a>          <span class="dt">legend.spacing.y =</span> <span class="kw">unit</span>(<span class="fl">0.02</span>, <span class="st">&quot;cm&quot;</span>)</span>
<span id="cb225-150"><a href="chapter10.html#cb225-150"></a>      )</span>
<span id="cb225-151"><a href="chapter10.html#cb225-151"></a>p3</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:Caurisplot"></span>
<img src="treedata_files/figure-html/Caurisplot-1.svg" alt="Antifungal susceptibility and point mutations in drug targets in Candida auris ." width="672"  />
<p class="caption">
Figure 10.3: <strong>Antifungal susceptibility and point mutations in drug targets in <em>Candida auris</em> </strong>.
</p>
</div>
<p>The advantage of using <a href="https://CRAN.R-project.org/package=ggplot2">ggplot2</a> is we do not need to take care of the details. We can provide the data, and tell how to map variables to aesthetics using <em>aes</em>. The legend also can be setted using <code>scale</code>. In addition, the tree be fully annotated with multiple layers also can be supported by <code>geom_fruit</code>. In this example, the phylogenetic tree is annotated with different color to show different clade. The external heat maps show the susceptibility to fluconazole (FCZ), amphotericin B (AMB) and micafungin (MCF). The external points show the point mutations in lanosterol 14-alpha-demethylase ERG11 (Y132F, K143R, and F126L) and beta-1,3-D-glucan synthase FKS1 (S639Y/P/F) associated with resistance <span class="citation">(Chow et al. <a href="#ref-Chowe:_2020" role="doc-biblioref">2020</a>)</span>.</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="chapter10.html#cb226-1"></a><span class="kw">library</span>(ggtreeExtra)</span>
<span id="cb226-2"><a href="chapter10.html#cb226-2"></a><span class="kw">library</span>(ggtree)</span>
<span id="cb226-3"><a href="chapter10.html#cb226-3"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb226-4"><a href="chapter10.html#cb226-4"></a><span class="kw">library</span>(ggnewscale)</span>
<span id="cb226-5"><a href="chapter10.html#cb226-5"></a><span class="kw">library</span>(treeio)</span>
<span id="cb226-6"><a href="chapter10.html#cb226-6"></a><span class="kw">library</span>(tidytree)</span>
<span id="cb226-7"><a href="chapter10.html#cb226-7"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb226-8"><a href="chapter10.html#cb226-8"></a><span class="kw">library</span>(ggstar)</span>
<span id="cb226-9"><a href="chapter10.html#cb226-9"></a></span>
<span id="cb226-10"><a href="chapter10.html#cb226-10"></a>tr &lt;-<span class="st"> </span><span class="kw">read.tree</span>(<span class="st">&quot;data/microreact/Salmonella_Typhi/microreact-project-NJIDqgsS-tree.nwk&quot;</span>)</span>
<span id="cb226-11"><a href="chapter10.html#cb226-11"></a></span>
<span id="cb226-12"><a href="chapter10.html#cb226-12"></a>metada &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/microreact/Salmonella_Typhi/microreact-project-NJIDqgsS-data.csv&quot;</span>)</span>
<span id="cb226-13"><a href="chapter10.html#cb226-13"></a></span>
<span id="cb226-14"><a href="chapter10.html#cb226-14"></a>metadata &lt;-<span class="st"> </span>metada <span class="op">%&gt;%</span></span>
<span id="cb226-15"><a href="chapter10.html#cb226-15"></a><span class="st">            </span><span class="kw">select</span>(<span class="kw">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;country&quot;</span>, <span class="st">&quot;country__colour&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;year__colour&quot;</span>, <span class="st">&quot;haplotype&quot;</span>))</span>
<span id="cb226-16"><a href="chapter10.html#cb226-16"></a>metadata<span class="op">$</span>haplotype &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">lapply</span>(metadata<span class="op">$</span>haplotype, <span class="cf">function</span>(x)<span class="kw">ifelse</span>(<span class="kw">nchar</span>(x)<span class="op">&gt;</span><span class="dv">0</span>,x,<span class="ot">NA</span>)))</span>
<span id="cb226-17"><a href="chapter10.html#cb226-17"></a></span>
<span id="cb226-18"><a href="chapter10.html#cb226-18"></a>countrycolors &lt;-<span class="st"> </span>metada <span class="op">%&gt;%</span></span>
<span id="cb226-19"><a href="chapter10.html#cb226-19"></a><span class="st">                 </span><span class="kw">select</span>(<span class="kw">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;country__colour&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb226-20"><a href="chapter10.html#cb226-20"></a><span class="st">                 </span><span class="kw">distinct</span>()</span>
<span id="cb226-21"><a href="chapter10.html#cb226-21"></a></span>
<span id="cb226-22"><a href="chapter10.html#cb226-22"></a>yearcolors &lt;-<span class="st"> </span>metada <span class="op">%&gt;%</span></span>
<span id="cb226-23"><a href="chapter10.html#cb226-23"></a><span class="st">              </span><span class="kw">select</span>(<span class="kw">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;year__colour&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb226-24"><a href="chapter10.html#cb226-24"></a><span class="st">              </span><span class="kw">distinct</span>()</span>
<span id="cb226-25"><a href="chapter10.html#cb226-25"></a>yearcolors &lt;-<span class="st"> </span>yearcolors[<span class="kw">order</span>(yearcolors<span class="op">$</span>year, <span class="dt">decreasing=</span><span class="ot">TRUE</span>),]</span>
<span id="cb226-26"><a href="chapter10.html#cb226-26"></a></span>
<span id="cb226-27"><a href="chapter10.html#cb226-27"></a>metadata<span class="op">$</span>country &lt;-<span class="st"> </span><span class="kw">factor</span>(metadata<span class="op">$</span>country, <span class="dt">levels=</span>countrycolors<span class="op">$</span>country)</span>
<span id="cb226-28"><a href="chapter10.html#cb226-28"></a>metadata<span class="op">$</span>year &lt;-<span class="st"> </span><span class="kw">factor</span>(metadata<span class="op">$</span>year, <span class="dt">levels=</span>yearcolors<span class="op">$</span>year)</span>
<span id="cb226-29"><a href="chapter10.html#cb226-29"></a></span>
<span id="cb226-30"><a href="chapter10.html#cb226-30"></a>p &lt;-<span class="st"> </span><span class="kw">ggtree</span>(tr, <span class="dt">layout=</span><span class="st">&quot;fan&quot;</span>, <span class="dt">open.angle=</span><span class="dv">15</span>, <span class="dt">size=</span><span class="fl">0.1</span>)</span>
<span id="cb226-31"><a href="chapter10.html#cb226-31"></a></span>
<span id="cb226-32"><a href="chapter10.html#cb226-32"></a>p &lt;-<span class="st"> </span>p <span class="op">%&lt;+%</span><span class="st"> </span>metadata</span>
<span id="cb226-33"><a href="chapter10.html#cb226-33"></a></span>
<span id="cb226-34"><a href="chapter10.html#cb226-34"></a>p1 &lt;-p <span class="op">+</span></span>
<span id="cb226-35"><a href="chapter10.html#cb226-35"></a><span class="st">     </span><span class="kw">geom_tippoint</span>(</span>
<span id="cb226-36"><a href="chapter10.html#cb226-36"></a>         <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">colour=</span>country),</span>
<span id="cb226-37"><a href="chapter10.html#cb226-37"></a>         <span class="dt">size=</span><span class="fl">1.5</span>,</span>
<span id="cb226-38"><a href="chapter10.html#cb226-38"></a>         <span class="dt">stroke=</span><span class="dv">0</span>,</span>
<span id="cb226-39"><a href="chapter10.html#cb226-39"></a>         <span class="dt">alpha=</span><span class="fl">0.4</span></span>
<span id="cb226-40"><a href="chapter10.html#cb226-40"></a>     ) <span class="op">+</span></span>
<span id="cb226-41"><a href="chapter10.html#cb226-41"></a><span class="st">     </span><span class="kw">scale_colour_manual</span>(</span>
<span id="cb226-42"><a href="chapter10.html#cb226-42"></a>         <span class="dt">name=</span><span class="st">&quot;Country&quot;</span>,</span>
<span id="cb226-43"><a href="chapter10.html#cb226-43"></a>         <span class="dt">values=</span>countrycolors<span class="op">$</span>country__colour,</span>
<span id="cb226-44"><a href="chapter10.html#cb226-44"></a>         <span class="dt">guide=</span><span class="kw">guide_legend</span>(<span class="dt">keywidth=</span><span class="fl">0.3</span>,</span>
<span id="cb226-45"><a href="chapter10.html#cb226-45"></a>                            <span class="dt">keyheight=</span><span class="fl">0.3</span>,</span>
<span id="cb226-46"><a href="chapter10.html#cb226-46"></a>                            <span class="dt">ncol=</span><span class="dv">2</span>,</span>
<span id="cb226-47"><a href="chapter10.html#cb226-47"></a>                            <span class="dt">override.aes=</span><span class="kw">list</span>(<span class="dt">size=</span><span class="dv">2</span>,<span class="dt">alpha=</span><span class="dv">1</span>),</span>
<span id="cb226-48"><a href="chapter10.html#cb226-48"></a>                            <span class="dt">order=</span><span class="dv">1</span>)</span>
<span id="cb226-49"><a href="chapter10.html#cb226-49"></a>     ) <span class="op">+</span></span>
<span id="cb226-50"><a href="chapter10.html#cb226-50"></a><span class="st">     </span><span class="kw">theme</span>(</span>
<span id="cb226-51"><a href="chapter10.html#cb226-51"></a>         <span class="dt">legend.title=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">5</span>),</span>
<span id="cb226-52"><a href="chapter10.html#cb226-52"></a>         <span class="dt">legend.text=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">4</span>),</span>
<span id="cb226-53"><a href="chapter10.html#cb226-53"></a>         <span class="dt">legend.spacing.y =</span> <span class="kw">unit</span>(<span class="fl">0.02</span>, <span class="st">&quot;cm&quot;</span>)</span>
<span id="cb226-54"><a href="chapter10.html#cb226-54"></a>     )</span>
<span id="cb226-55"><a href="chapter10.html#cb226-55"></a></span>
<span id="cb226-56"><a href="chapter10.html#cb226-56"></a>p2 &lt;-p1 <span class="op">+</span></span>
<span id="cb226-57"><a href="chapter10.html#cb226-57"></a><span class="st">     </span><span class="kw">geom_fruit</span>(</span>
<span id="cb226-58"><a href="chapter10.html#cb226-58"></a>         <span class="dt">geom=</span>geom_star,</span>
<span id="cb226-59"><a href="chapter10.html#cb226-59"></a>         <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">fill=</span>haplotype),</span>
<span id="cb226-60"><a href="chapter10.html#cb226-60"></a>         <span class="dt">starshape=</span><span class="dv">26</span>,</span>
<span id="cb226-61"><a href="chapter10.html#cb226-61"></a>         <span class="dt">color=</span><span class="ot">NA</span>,</span>
<span id="cb226-62"><a href="chapter10.html#cb226-62"></a>         <span class="dt">size=</span><span class="dv">2</span>,</span>
<span id="cb226-63"><a href="chapter10.html#cb226-63"></a>         <span class="dt">starstroke=</span><span class="dv">0</span>,</span>
<span id="cb226-64"><a href="chapter10.html#cb226-64"></a>         <span class="dt">offset=</span><span class="dv">0</span>,</span>
<span id="cb226-65"><a href="chapter10.html#cb226-65"></a>     ) <span class="op">+</span></span>
<span id="cb226-66"><a href="chapter10.html#cb226-66"></a><span class="st">     </span><span class="kw">scale_fill_manual</span>(</span>
<span id="cb226-67"><a href="chapter10.html#cb226-67"></a>         <span class="dt">name=</span><span class="st">&quot;Haplotype&quot;</span>,</span>
<span id="cb226-68"><a href="chapter10.html#cb226-68"></a>         <span class="dt">values=</span><span class="kw">c</span>(<span class="st">&quot;red&quot;</span>),</span>
<span id="cb226-69"><a href="chapter10.html#cb226-69"></a>         <span class="dt">guide=</span><span class="kw">guide_legend</span>(</span>
<span id="cb226-70"><a href="chapter10.html#cb226-70"></a>                   <span class="dt">keywidth=</span><span class="fl">0.3</span>,</span>
<span id="cb226-71"><a href="chapter10.html#cb226-71"></a>                   <span class="dt">keyheight=</span><span class="fl">0.3</span>,</span>
<span id="cb226-72"><a href="chapter10.html#cb226-72"></a>                   <span class="dt">order=</span><span class="dv">3</span></span>
<span id="cb226-73"><a href="chapter10.html#cb226-73"></a>               ),</span>
<span id="cb226-74"><a href="chapter10.html#cb226-74"></a>         <span class="dt">na.translate=</span><span class="ot">FALSE</span></span>
<span id="cb226-75"><a href="chapter10.html#cb226-75"></a>     )</span>
<span id="cb226-76"><a href="chapter10.html#cb226-76"></a></span>
<span id="cb226-77"><a href="chapter10.html#cb226-77"></a>p3 &lt;-p2 <span class="op">+</span></span>
<span id="cb226-78"><a href="chapter10.html#cb226-78"></a><span class="st">     </span><span class="kw">new_scale_fill</span>() <span class="op">+</span></span>
<span id="cb226-79"><a href="chapter10.html#cb226-79"></a><span class="st">     </span><span class="kw">geom_fruit</span>(</span>
<span id="cb226-80"><a href="chapter10.html#cb226-80"></a>         <span class="dt">geom=</span>geom_tile,</span>
<span id="cb226-81"><a href="chapter10.html#cb226-81"></a>         <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">fill=</span>year),</span>
<span id="cb226-82"><a href="chapter10.html#cb226-82"></a>         <span class="dt">width=</span><span class="fl">0.002</span>,</span>
<span id="cb226-83"><a href="chapter10.html#cb226-83"></a>         <span class="dt">offset=</span><span class="fl">0.1</span></span>
<span id="cb226-84"><a href="chapter10.html#cb226-84"></a>     ) <span class="op">+</span></span>
<span id="cb226-85"><a href="chapter10.html#cb226-85"></a><span class="st">     </span><span class="kw">scale_fill_manual</span>(</span>
<span id="cb226-86"><a href="chapter10.html#cb226-86"></a>         <span class="dt">name=</span><span class="st">&quot;Year&quot;</span>,</span>
<span id="cb226-87"><a href="chapter10.html#cb226-87"></a>         <span class="dt">values=</span>yearcolors<span class="op">$</span>year__colour,</span>
<span id="cb226-88"><a href="chapter10.html#cb226-88"></a>         <span class="dt">guide=</span><span class="kw">guide_legend</span>(<span class="dt">keywidth=</span><span class="fl">0.3</span>, <span class="dt">keyheight=</span><span class="fl">0.3</span>, <span class="dt">ncol=</span><span class="dv">2</span>, <span class="dt">order=</span><span class="dv">2</span>)</span>
<span id="cb226-89"><a href="chapter10.html#cb226-89"></a>     ) <span class="op">+</span></span>
<span id="cb226-90"><a href="chapter10.html#cb226-90"></a><span class="st">     </span><span class="kw">theme</span>(</span>
<span id="cb226-91"><a href="chapter10.html#cb226-91"></a>           <span class="dt">legend.title=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">6</span>), <span class="co"># The size should be adjusted with the different devout.</span></span>
<span id="cb226-92"><a href="chapter10.html#cb226-92"></a>           <span class="dt">legend.text=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="fl">4.5</span>),</span>
<span id="cb226-93"><a href="chapter10.html#cb226-93"></a>           <span class="dt">legend.spacing.y =</span> <span class="kw">unit</span>(<span class="fl">0.02</span>, <span class="st">&quot;cm&quot;</span>)</span>
<span id="cb226-94"><a href="chapter10.html#cb226-94"></a>           )</span>
<span id="cb226-95"><a href="chapter10.html#cb226-95"></a>p3</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:Styphiplot"></span>
<img src="treedata_files/figure-html/Styphiplot-1.svg" alt="Population structure of the 1,832 S. Typhi isolates." width="672"  />
<p class="caption">
Figure 10.4: <strong>Population structure of the 1,832 <em>S. Typhi</em> isolates</strong>.
</p>
</div>
<p>Except the point mutations, the associated data about region and time also can be annotated. This is an rooted maximum-likelihood tree of <em>S. Typhi</em> inferred from 22,145 SNPs <span class="citation">(Wong et al. <a href="#ref-RN46:_2015" role="doc-biblioref">2015</a>)</span>, the color of tip points represent the geographical origin of the isolates, and the red points of external layer indicate H58 lineage. The color of external heat map indicates the years of isolation <span class="citation">(Wong et al. <a href="#ref-RN46:_2015" role="doc-biblioref">2015</a>)</span>.</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-GraPhlAn">
<p>Asnicar, Francesco, George Weingart, Timothy L Tickle, Curtis Huttenhower, and Nicola Segata. 2015. ‚ÄúCompact Graphical Representation of Phylogenetic Data and Metadata with Graphlan.‚Äù <em>PeerJ</em> 3: e1029. <a href="https://doi.org/10.7717/peerj.1029">https://doi.org/10.7717/peerj.1029</a>.</p>
</div>
<div id="ref-Chowe:_2020">
<p>Chow, Nancy A., Jos√© F. Mu√±oz, Lalitha Gade, Elizabeth L. Berkow, Xiao Li, Rory M. Welsh, Kaitlin Forsberg, et al. 2020. ‚ÄúTracing the Evolutionary History and Global Expansion of Candida Auris Using Population Genomic Analyses.‚Äù Edited by Geraldine Butler and Kirsten Nielsen. <em>mBio</em> 11 (2). <a href="https://doi.org/10.1128/mBio.03364-19">https://doi.org/10.1128/mBio.03364-19</a>.</p>
</div>
<div id="ref-morgan2013HMP">
<p>Morgan, Xochitl C., Nicola Segata, and Curtis Huttenhower. 2013. ‚ÄúBiodiversity and Functional Genomics in the Human Microbiome.‚Äù <em>Trends in Genetics</em> 29 (1): 51‚Äì58. <a href="https://doi.org/10.1016/J.TIG.2012.09.005">https://doi.org/10.1016/J.TIG.2012.09.005</a>.</p>
</div>
<div id="ref-wickham_ggplot2_2009">
<p>Wickham, Hadley. 2009. <em>Ggplot2: Elegant Graphics for Data Analysis</em>. 1st ed. Springer.</p>
</div>
<div id="ref-RN46:_2015">
<p>Wong, Vanessa K., Stephen Baker, Derek J. Pickard, Julian Parkhill, Andrew J. Page, Nicholas A. Feasey, Robert A. Kingsley, et al. 2015. ‚ÄúPhylogeographical Analysis of the Dominant Multidrug-Resistant H58 Clade of Salmonella Typhi Identifies Inter- and Intracontinental Transmission Events.‚Äù Journal Article. <em>Nature Genetics</em> 47 (6): 632‚Äì39. <a href="https://doi.org/10.1038/ng.3281">https://doi.org/10.1038/ng.3281</a>.</p>
</div>
<div id="ref-yu_ggtree:_2017">
<p>Yu, Guangchuang, David K. Smith, Huachen Zhu, Yi Guan, and Tommy Tsan-Yuk Lam. 2017. ‚ÄúGgtree: An R Package for Visualization and Annotation of Phylogenetic Trees with Their Covariates and Other Associated Data.‚Äù <em>Methods in Ecology and Evolution</em> 8 (1): 28‚Äì36. <a href="https://doi.org/10.1111/2041-210X.12628">https://doi.org/10.1111/2041-210X.12628</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chapter9.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chapter11.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["treedata.pdf", "treedata.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
