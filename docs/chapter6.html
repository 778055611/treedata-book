<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 6 Visual Exploration of Phylogenetic Tree | Data Integration, Manipulation and Visualization of Phylogenetic Trees</title>
<meta name="author" content="Guangchuang Yu">
<!-- CSS --><!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.5/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.2/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.2/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.1.9000/tabs.js"></script><script src="libs/bs3compat-0.2.1.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/font-awesome-5.3.1/css/fontawesome-all.min.css" rel="stylesheet">
<script src="libs/htmlwidgets-1.5.2/htmlwidgets.js"></script><script src="libs/pathseg-1.0.2/pathseg.js"></script><script src="libs/comic-0.961/comic.min.js"></script><script src="libs/comicR-binding-0.2/comicR.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Data Integration, Manipulation and Visualization of Phylogenetic Trees</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="introduction.html">Introduction</a></li>
<li class="book-part">Part I: Tree data input, output and manipulation</li>
<li><a class="" href="chapter1.html"><span class="header-section-number">1</span> Importing Tree with Data</a></li>
<li><a class="" href="chapter2.html"><span class="header-section-number">2</span> Manipulating Tree with Data</a></li>
<li><a class="" href="chapter3.html"><span class="header-section-number">3</span> Exporting tree with data</a></li>
<li class="book-part">Part II: Tree data visualization and annotation</li>
<li><a class="" href="chapter4.html"><span class="header-section-number">4</span> Phylogenetic Tree Visualization</a></li>
<li><a class="" href="chapter5.html"><span class="header-section-number">5</span> Phylogenetic Tree Annotation</a></li>
<li><a class="active" href="chapter6.html"><span class="header-section-number">6</span> Visual Exploration of Phylogenetic Tree</a></li>
<li><a class="" href="chapter7.html"><span class="header-section-number">7</span> Plotting tree with data</a></li>
<li><a class="" href="chapter8.html"><span class="header-section-number">8</span> Annotating Tree with Silhouette Images and Sub-plots</a></li>
<li><a class="" href="chapter9.html"><span class="header-section-number">9</span> ggtree for other tree-like objects</a></li>
<li class="book-part">Part III: ggtree extensions</li>
<li><a class="" href="chapter10.html"><span class="header-section-number">10</span> ggtreeExtra</a></li>
<li><a class="" href="chapter11.html"><span class="header-section-number">11</span> Other ggtree extensions</a></li>
<li class="book-part">Part IV: Miscellaneous topics</li>
<li><a class="" href="chapter12.html"><span class="header-section-number">12</span> ggtree utilities</a></li>
<li><a class="" href="chapter13.html"><span class="header-section-number">13</span> Gallery of reproducible examples</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="faq.html"><span class="header-section-number">A</span> Frequently asked questions</a></li>
<li><a class="" href="related-tools.html"><span class="header-section-number">B</span> Related tools</a></li>
<li><a class="" href="figures-and-tables.html"><span class="header-section-number">C</span> Figures and Tables</a></li>
<li><a class="" href="session-info.html"><span class="header-section-number">D</span> Session Info</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="chapter6" class="section level1" number="6">
<h1>
<span class="header-section-number">6</span> Visual Exploration of Phylogenetic Tree<a class="anchor" aria-label="anchor" href="#chapter6"><i class="fas fa-link"></i></a>
</h1>
<p>The <a href="http://bioconductor.org/packages/ggtree">ggtree</a> <span class="citation">(Yu et al. <a href="references.html#ref-yu_ggtree:_2017" role="doc-biblioref">2017</a>)</span> supports many ways of manipulating the tree visually, including viewing selected clade to explore large tree (Figure <a href="chapter6.html#fig:viewClade">6.1</a>), taxa clustering (Figure <a href="chapter6.html#fig:groupOTU">6.5</a>), rotating clade or tree (Figure <a href="chapter6.html#fig:rfClade">6.6</a>B and <a href="chapter6.html#fig:rotateTree">6.8</a>), zoom out or collapsing clades (Figure <a href="chapter6.html#fig:collapseExpand">6.3</a>A and <a href="chapter6.html#fig:scaleClade">6.2</a>), <em>etc.</em>. Details tree manipulation functions are summarized in Table <a href="chapter6.html#tab:treeman">6.1</a>.</p>
<div class="inline-table"><table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:treeman">Table 6.1: </span>Tree manipulation functions.
</caption>
<thead><tr>
<th style="text-align:left;">
Function
</th>
<th style="text-align:left;">
Descriptiotn
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
collapse
</td>
<td style="text-align:left;">
collapse a selecting clade
</td>
</tr>
<tr>
<td style="text-align:left;">
expand
</td>
<td style="text-align:left;">
expand collapsed clade
</td>
</tr>
<tr>
<td style="text-align:left;">
flip
</td>
<td style="text-align:left;">
exchange position of 2 clades that share a parent node
</td>
</tr>
<tr>
<td style="text-align:left;">
groupClade
</td>
<td style="text-align:left;">
grouping clades
</td>
</tr>
<tr>
<td style="text-align:left;">
groupOTU
</td>
<td style="text-align:left;">
grouping OTUs by tracing back to most recent common ancestor
</td>
</tr>
<tr>
<td style="text-align:left;">
identify
</td>
<td style="text-align:left;">
interactive tree manipulation
</td>
</tr>
<tr>
<td style="text-align:left;">
rotate
</td>
<td style="text-align:left;">
rotating a selected clade by 180 degree
</td>
</tr>
<tr>
<td style="text-align:left;">
rotate_tree
</td>
<td style="text-align:left;">
rotating circular layout tree by specific angle
</td>
</tr>
<tr>
<td style="text-align:left;">
scaleClade
</td>
<td style="text-align:left;">
zoom in or zoom out selecting clade
</td>
</tr>
<tr>
<td style="text-align:left;">
open_tree
</td>
<td style="text-align:left;">
convert a tree to fan layout by specific open angle
</td>
</tr>
</tbody>
</table></div>
<div id="viewing-selected-clade" class="section level2" number="6.1">
<h2>
<span class="header-section-number">6.1</span> Viewing Selected Clade<a class="anchor" aria-label="anchor" href="#viewing-selected-clade"><i class="fas fa-link"></i></a>
</h2>
<p>A clade is a monophyletic group that contains a single ancestor and all of its descendants. We can visualize a specific selected clade via the <code>viewClade</code> function as demonstrated in Figure <a href="chapter6.html#fig:viewClade">6.1</a>B. Another solution is to extract the selected clade as a new tree object as described in <a href="chapter2.html#subsetting-tree-with-data">session 2.5</a>. These functions are developed to help users exploring large tree.</p>


<div class="sourceCode" id="cb174"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/treedata-book/">ggtree</a></span><span class="op">)</span>
<span class="va">nwk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"sample.nwk"</span>, package<span class="op">=</span><span class="st">"treeio"</span><span class="op">)</span>
<span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.tree.html">read.tree</a></span><span class="op">(</span><span class="va">nwk</span><span class="op">)</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/viewClade.html">viewClade</a></span><span class="op">(</span><span class="va">p</span>, <span class="fu"><a href="https://rdrr.io/pkg/tidytree/man/MRCA.html">MRCA</a></span><span class="op">(</span><span class="va">p</span>, <span class="st">"I"</span>, <span class="st">"L"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span id="fig:viewClade"></span>
<img src="treedata_files/figure-html/viewClade-1.svg" alt="Viewing a selected clade of a tree. An example tree used to demonstrate how ggtree support exploring or manipulating phylogenetic tree visually (A). The ggtree supports visualizing selected clade (B). A clade can be selected by specifying a node number or determined by most recent common ancestor of selected tips." width="100%"><p class="caption">
Figure 6.1: <strong>Viewing a selected clade of a tree.</strong> An example tree used to demonstrate how <em>ggtree</em> support exploring or manipulating phylogenetic tree visually (A). The <em>ggtree</em> supports visualizing selected clade (B). A clade can be selected by specifying a node number or determined by most recent common ancestor of selected tips.
</p>
</div>
<p>Some of the functions, <em>e.g.</em> <code>viewClade</code>, work with clade and accept a parameter of internal node number. To get the internal node number, user can use <code><a href="https://rdrr.io/pkg/tidytree/man/MRCA.html">MRCA()</a></code> function (as in Figure <a href="chapter6.html#fig:viewClade">6.1</a>) by providing two taxa names. The function will return node number of input taxa’s most recent common ancestor (MRCA). It works with tree and graphic (<em>i.e.</em> <code><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree()</a></code> output) object. <a href="https://CRAN.R-project.org/package=tidytree">tidytree</a> also provide <code>MRCA</code> function to extract information of MRCA node (see details in <a href="chapter2.html#accesor-tidytree">session 2.1.3</a>).</p>
</div>
<div id="scale-clade" class="section level2" number="6.2">
<h2>
<span class="header-section-number">6.2</span> Scaling Selected Clade<a class="anchor" aria-label="anchor" href="#scale-clade"><i class="fas fa-link"></i></a>
</h2>
<p>The <em>ggtree</em> provides another option to zoom out (or compress) these clades via the <code>scaleClade</code> function. In this way, we retain the topology and branch lengths of compressed clades. This helps to save the space to highlight those clades of primary interest to the study.</p>


<div class="sourceCode" id="cb175"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tidytree/man/groupClade.html">groupClade</a></span><span class="op">(</span><span class="va">tree</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">17</span>, <span class="fl">21</span><span class="op">)</span><span class="op">)</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">tree2</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">'none'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"firebrick"</span>, <span class="st">"steelblue"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/scaleClade.html">scaleClade</a></span><span class="op">(</span><span class="va">p</span>, node<span class="op">=</span><span class="fl">17</span>, scale<span class="op">=</span><span class="fl">.1</span><span class="op">)</span> </code></pre></div>
<div class="figure">
<span id="fig:scaleClade"></span>
<img src="treedata_files/figure-html/scaleClade-1.svg" alt="Scaling selected clade. Clades can be zoom in (if scale &gt; 1) to highlight or zoom out to save space." width="100%"><p class="caption">
Figure 6.2: <strong>Scaling selected clade.</strong> Clades can be zoom in (if <code>scale &gt; 1</code>) to highlight or zoom out to save space.
</p>
</div>
<p>If users want to emphasize important clades, they can use <code>scaleClade</code> function with <code>scale</code> parameter larger than 1. Then the selected clade will be zoomed in. Users can also use <code>groupClade</code> to select clades and color them with different colors as shown in Figure <a href="chapter6.html#fig:scaleClade">6.2</a>.</p>
</div>
<div id="collapsing-and-expanding-clade" class="section level2" number="6.3">
<h2>
<span class="header-section-number">6.3</span> Collapsing and Expanding Clade<a class="anchor" aria-label="anchor" href="#collapsing-and-expanding-clade"><i class="fas fa-link"></i></a>
</h2>
<p>It is a common practice to prune or collapse clades so that certain aspects of a tree can be emphasized. The <em>ggtree</em> supports collapsing selected clades using the <code>collapse</code> function as shown in Figure <a href="chapter6.html#fig:collapseExpand">6.3</a>A.</p>


<div class="sourceCode" id="cb176"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/compute.html">collapse</a></span><span class="op">(</span>node<span class="op">=</span><span class="fl">21</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_point2.html">geom_point2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>subset<span class="op">=</span><span class="op">(</span><span class="va">node</span><span class="op">==</span><span class="fl">21</span><span class="op">)</span><span class="op">)</span>, shape<span class="op">=</span><span class="fl">21</span>, size<span class="op">=</span><span class="fl">5</span>, fill<span class="op">=</span><span class="st">'green'</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/compute.html">collapse</a></span><span class="op">(</span><span class="va">p2</span>, node<span class="op">=</span><span class="fl">23</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_point2.html">geom_point2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>subset<span class="op">=</span><span class="op">(</span><span class="va">node</span><span class="op">==</span><span class="fl">23</span><span class="op">)</span><span class="op">)</span>, shape<span class="op">=</span><span class="fl">23</span>, size<span class="op">=</span><span class="fl">5</span>, fill<span class="op">=</span><span class="st">'red'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/expand.html">expand</a></span><span class="op">(</span><span class="va">p2</span>, node<span class="op">=</span><span class="fl">23</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/expand.html">expand</a></span><span class="op">(</span>node<span class="op">=</span><span class="fl">21</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span id="fig:collapseExpand"></span>
<img src="treedata_files/figure-html/collapseExpand-1.svg" alt="Collapsing selected clades and expanding collapsed clades. Clades can be selected to collapse (A) and the collapsed clades can be expanded back (B) if necessary as ggtree stored all information of species relationships. Green and red symbols were displayed on the tree to indicate the collapsed clades." width="100%"><p class="caption">
Figure 6.3: <strong>Collapsing selected clades and expanding collapsed clades.</strong> Clades can be selected to collapse (A) and the collapsed clades can be expanded back (B) if necessary as <em>ggtree</em> stored all information of species relationships. Green and red symbols were displayed on the tree to indicate the collapsed clades.
</p>
</div>
<p>Here two clades were collapsed and labelled by green circle and red square symbolic points. Collapsing is a common strategy to collapse clades that are too large for displaying in full or are not primary interest of the study. In <em>ggtree</em>, we can expand (<em>i.e.</em>, uncollapse) the collapsed branches back with <code>expand</code> function to show details of species relationships as demonstrated in Figure <a href="chapter6.html#fig:collapseExpand">6.3</a>B.</p>
<p>Triangles are often used to represent the collapsed clade and <a href="http://bioconductor.org/packages/ggtree">ggtree</a> also supports it. The <code>collapse</code> function provides a “mode” parameter, which by default is “none” and the selected clade was collapsed as a “tip”. User can specify <code>mode</code> to “max” (Figure <a href="chapter6.html#fig:collapseMode">6.4</a>A), “min” (Figure <a href="chapter6.html#fig:collapseMode">6.4</a>B) and “mixed” (Figure <a href="chapter6.html#fig:collapseMode">6.4</a>C).</p>
<div class="sourceCode" id="cb177"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">node</span> <span class="op">&lt;-</span> <span class="fl">21</span>
<span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/compute.html">collapse</a></span><span class="op">(</span><span class="va">p2</span>, <span class="va">node</span>, <span class="st">'max'</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/expand.html">expand</a></span><span class="op">(</span><span class="va">node</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/compute.html">collapse</a></span><span class="op">(</span><span class="va">p2</span>, <span class="va">node</span>, <span class="st">'min'</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/expand.html">expand</a></span><span class="op">(</span><span class="va">node</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/compute.html">collapse</a></span><span class="op">(</span><span class="va">p2</span>, <span class="va">node</span>, <span class="st">'mixed'</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/expand.html">expand</a></span><span class="op">(</span><span class="va">node</span><span class="op">)</span></code></pre></div>
<p>We can pass additional parameter to set the color and transparency of the triangles (Figure <a href="chapter6.html#fig:collapseMode">6.4</a>D).</p>
<div class="sourceCode" id="cb178"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/compute.html">collapse</a></span><span class="op">(</span><span class="va">p</span>, <span class="fl">21</span>, <span class="st">'mixed'</span>, fill<span class="op">=</span><span class="st">'steelblue'</span>, alpha<span class="op">=</span><span class="fl">.4</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/compute.html">collapse</a></span><span class="op">(</span><span class="fl">23</span>, <span class="st">'mixed'</span>, fill<span class="op">=</span><span class="st">'firebrick'</span>, color<span class="op">=</span><span class="st">'blue'</span><span class="op">)</span></code></pre></div>
<p>We can combine <a href="chapter6.html#scale-clade">scaleClade</a> with <code>collapse</code> to zoom in/out of the triangles (Figure <a href="chapter6.html#fig:collapseMode">6.4</a>E).</p>
<div class="sourceCode" id="cb179"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/scaleClade.html">scaleClade</a></span><span class="op">(</span><span class="va">p</span>, <span class="fl">23</span>, <span class="fl">.2</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/compute.html">collapse</a></span><span class="op">(</span><span class="fl">23</span>, <span class="st">'min'</span>, fill<span class="op">=</span><span class="st">"darkgreen"</span><span class="op">)</span>  </code></pre></div>


<div class="figure">
<span id="fig:collapseMode"></span>
<img src="treedata_files/figure-html/collapseMode-1.svg" alt="Collapse clade as triangle. ‘max’ takes the position of most distant tip (A). ‘min’ takes the position of closest tip (B). ‘mixed’ takes the positions of both closest and distant tips (C), which looks more like the shape of the clade. Set color, fill and alpha of the triangles (D). Combine with scaleClade to zoom out triangle to save space (E)." width="100%"><p class="caption">
Figure 6.4: <strong>Collapse clade as triangle.</strong> ‘max’ takes the position of most distant tip (A). ‘min’ takes the position of closest tip (B). ‘mixed’ takes the positions of both closest and distant tips (C), which looks more like the shape of the clade. Set color, fill and alpha of the triangles (D). Combine with <code>scaleClade</code> to zoom out triangle to save space (E).
</p>
</div>
</div>
<div id="group-taxa-vis" class="section level2" number="6.4">
<h2>
<span class="header-section-number">6.4</span> Grouping Taxa<a class="anchor" aria-label="anchor" href="#group-taxa-vis"><i class="fas fa-link"></i></a>
</h2>
<p>The <code>groupClade</code> function assigns the branches and nodes under different clades into different groups. <em><code>groupClade</code></em> accepts an internal node or a vector of internal nodes to cluster clade/clades.</p>
<p>Similarly, <code>groupOTU</code> function assigns branches and nodes to different groups based on user-specified groups of operational taxonomic units (OTUs) that are not necessarily within a clade, but can be monophyletic (clade), polyphyletic or paraphyletic. It accepts a vector of OTUs (taxa name) or a list of OTUs and will trace back from OTUs to their most recent common ancestor (MRCA) and cluster them together as demonstrated in Figure <a href="chapter6.html#fig:groupOTU">6.5</a>.</p>
<p>A phylogenetic tree can be annotated by mapping different line type, size, color or shape to the branches or nodes that have been assigned to different groups.</p>


<div class="sourceCode" id="cb180"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span>
<span class="va">rn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>,<span class="fl">5</span><span class="op">]</span>, <span class="st">"_"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">150</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">rn</span>
<span class="va">d_iris</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>,<span class="op">-</span><span class="fl">5</span><span class="op">]</span>, method<span class="op">=</span><span class="st">"man"</span><span class="op">)</span>

<span class="va">tree_iris</span> <span class="op">&lt;-</span> <span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/bionj.html">bionj</a></span><span class="op">(</span><span class="va">d_iris</span><span class="op">)</span>
<span class="va">grp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>setosa     <span class="op">=</span> <span class="va">rn</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">]</span>,
            versicolor <span class="op">=</span> <span class="va">rn</span><span class="op">[</span><span class="fl">51</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span>,
            virginica  <span class="op">=</span> <span class="va">rn</span><span class="op">[</span><span class="fl">101</span><span class="op">:</span><span class="fl">150</span><span class="op">]</span><span class="op">)</span>

<span class="va">p_iris</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">tree_iris</span>, layout <span class="op">=</span> <span class="st">'circular'</span>, branch.length<span class="op">=</span><span class="st">'none'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/tidytree/man/groupOTU.html">groupOTU</a></span><span class="op">(</span><span class="va">p_iris</span>, <span class="va">grp</span>, <span class="st">'Species'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">Species</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"right"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span id="fig:groupOTU"></span>
<img src="treedata_files/figure-html/groupOTU-1.svg" alt="Grouping OTUs. OTU clustering based on their relationships. Selected OTUs and their ancestors upto MRCA will be clustered together." width="100%"><p class="caption">
Figure 6.5: <strong>Grouping OTUs.</strong> OTU clustering based on their relationships. Selected OTUs and their ancestors upto MRCA will be clustered together.
</p>
</div>
<p>We can grouping taxa at tree level. The following code will produce identical figure of Figure <a href="chapter6.html#fig:groupOTU">6.5</a> (see more details described at <a href="chapter2.html#grouping-taxa">session 2.2.3</a>).</p>
<div class="sourceCode" id="cb181"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree_iris</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tidytree/man/groupOTU.html">groupOTU</a></span><span class="op">(</span><span class="va">tree_iris</span>, <span class="va">grp</span>, <span class="st">"Species"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">tree_iris</span>, <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">Species</span><span class="op">)</span>, layout <span class="op">=</span> <span class="st">'circular'</span>, branch.length <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"right"</span><span class="op">)</span></code></pre></div>
</div>
<div id="exploring-tree-structure" class="section level2" number="6.5">
<h2>
<span class="header-section-number">6.5</span> Exploring tree structure<a class="anchor" aria-label="anchor" href="#exploring-tree-structure"><i class="fas fa-link"></i></a>
</h2>
<p>To facilitate exploring the tree structure, <em>ggtree</em> supports rotating selected clade by 180 degree using the <code><a href="https://rdrr.io/pkg/ggtree/man/rotate.html">rotate()</a></code> function (Figure <a href="chapter6.html#fig:rfClade">6.6</a>B). Position of immediate descendant clades of internal node can be exchanged via <code><a href="https://rdrr.io/pkg/ggtree/man/flip.html">flip()</a></code> function (Figure <a href="chapter6.html#fig:rfClade">6.6</a>C).</p>


<div class="sourceCode" id="cb182"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_point2.html">geom_point2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>subset<span class="op">=</span><span class="va">node</span><span class="op">==</span><span class="fl">16</span><span class="op">)</span>, color<span class="op">=</span><span class="st">'darkgreen'</span>, size<span class="op">=</span><span class="fl">5</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/rotate.html">rotate</a></span><span class="op">(</span><span class="va">p1</span>, <span class="fl">17</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/rotate.html">rotate</a></span><span class="op">(</span><span class="fl">21</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/flip.html">flip</a></span><span class="op">(</span><span class="va">p2</span>, <span class="fl">17</span>, <span class="fl">21</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span id="fig:rfClade"></span>
<img src="treedata_files/figure-html/rfClade-1.svg" alt="Exploring tree structure. A clade (indicated by darkgreen circle) in a tree (A) can be rotated by 180° (B) and the positions of its immediate descedant clades (colored by blue and red) can be exchanged (C)." width="100%"><p class="caption">
Figure 6.6: <strong>Exploring tree structure.</strong> A clade (indicated by darkgreen circle) in a tree (A) can be rotated by 180° (B) and the positions of its immediate descedant clades (colored by blue and red) can be exchanged (C).
</p>
</div>
<p>Most of the tree manipulation functions are working on clades, while <a href="http://bioconductor.org/packages/ggtree">ggtree</a> also provides functions to manipulate a tree, including <code><a href="https://rdrr.io/pkg/ggtree/man/open_tree.html">open_tree()</a></code> to transform a tree in either rectangular or circular layout to fan layout, and <code><a href="https://rdrr.io/pkg/ggtree/man/rotate_tree.html">rotate_tree()</a></code> function to rotate a tree for specific angle in both circular or fan layouts, as demonstrated in Figure <a href="chapter6.html#fig:openTree">6.7</a> and <a href="chapter6.html#fig:rotateTree">6.8</a>.</p>
<div class="sourceCode" id="cb183"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/open_tree.html">open_tree</a></span><span class="op">(</span><span class="va">p</span>, <span class="fl">180</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p3</span><span class="op">)</span></code></pre></div>


<div class="figure">
<span id="fig:openTree"></span>
<img src="treedata_files/figure-html/openTree-1.svg" alt="Transforming a tree to fan layout. A tree can be transformed to fan layout by open_tree with specific angle parameter." width="576"><p class="caption">
Figure 6.7: <strong>Transforming a tree to fan layout.</strong> A tree can be transformed to fan layout by <code>open_tree</code> with specific <em>angle</em> parameter.
</p>
</div>
<div class="sourceCode" id="cb184"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/rotate_tree.html">rotate_tree</a></span><span class="op">(</span><span class="va">p3</span>, <span class="fl">180</span><span class="op">)</span></code></pre></div>


<div class="figure">
<span id="fig:rotateTree"></span>
<img src="treedata_files/figure-html/rotateTree-1.svg" alt="Rotating tree. A circular/fan layout tree can be rotated by any specific angle." width="576"><p class="caption">
Figure 6.8: <strong>Rotating tree.</strong> A circular/fan layout tree can be rotated by any specific <em>angle</em>.
</p>
</div>
<p>The following example traverse all the internal nodes and rotate them one by one (Figure <a href="chapter6.html#fig:rotategif">6.9</a>).</p>
<div class="sourceCode" id="cb185"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2016</span><span class="op">-</span><span class="fl">05</span><span class="op">-</span><span class="fl">29</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/rtree.html">rtree</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">'postorder'</span><span class="op">)</span><span class="op">$</span><span class="va">edge</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">%&gt;%</span> <span class="va">unique</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/rotate.html">rotate</a></span><span class="op">(</span><span class="va">p</span>, <span class="va">n</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_point2.html">geom_point2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggplot2/man/aes.html">aes</a></span><span class="op">(</span>subset<span class="op">=</span><span class="op">(</span><span class="va">node</span> <span class="op">==</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span>, color<span class="op">=</span><span class="st">'red'</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>


<div class="figure">
<span id="fig:rotategif"></span>
<img src="img/rotate_clade.gif" alt="Traverse and rotate all clades."><p class="caption">
Figure 6.9: <strong>Traverse and rotate all clades.</strong>
</p>
</div>
<div class="sourceCode" id="cb186"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="va">tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/rtree.html">rtree</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">tr</span>, layout<span class="op">=</span><span class="st">'circular'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab</a></span><span class="op">(</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">angle</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">270</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/open_tree.html">open_tree</a></span><span class="op">(</span><span class="va">p</span>, angle<span class="op">=</span><span class="va">angle</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"open angle:"</span>, <span class="va">angle</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Figure <a href="chapter6.html#fig:fangif">6.10</a> demonstrates the usage of <code>open_tree</code> with different open angles.</p>


<div class="figure">
<span id="fig:fangif"></span>
<img src="img/fan_layout.gif" alt="Open tree with different angles."><p class="caption">
Figure 6.10: <strong>Open tree with different angles.</strong>
</p>
</div>
<p>Figure <a href="chapter6.html#fig:rotatetreegif">6.11</a> illustrates rotating tree with different angles.</p>
<div class="sourceCode" id="cb187"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">for</span> <span class="op">(</span><span class="va">angle</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">270</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/rotate_tree.html">rotate_tree</a></span><span class="op">(</span><span class="va">p</span>, <span class="va">angle</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"rotate angle:"</span>, <span class="va">angle</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>


<div class="figure">
<span id="fig:rotatetreegif"></span>
<img src="img/rotate_tree.gif" alt="Rotate tree with different angles."><p class="caption">
Figure 6.11: <strong>Rotate tree with different angles.</strong>
</p>
</div>
<p>Interactive tree manipulation is also possible via <a href="chapter12.html#identify"><code>identify</code> methods</a>.</p>
</div>
<div id="summary6" class="section level2" number="6.6">
<h2>
<span class="header-section-number">6.6</span> Summary<a class="anchor" aria-label="anchor" href="#summary6"><i class="fas fa-link"></i></a>
</h2>
<p>The <a href="http://bioconductor.org/packages/ggtree">ggtree</a> provides a set of functions to allow visually manipulating phylogenetic tree and exploring tree structure with associated data.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="chapter5.html"><span class="header-section-number">5</span> Phylogenetic Tree Annotation</a></div>
<div class="next"><a href="chapter7.html"><span class="header-section-number">7</span> Plotting tree with data</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#chapter6"><span class="header-section-number">6</span> Visual Exploration of Phylogenetic Tree</a></li>
<li><a class="nav-link" href="#viewing-selected-clade"><span class="header-section-number">6.1</span> Viewing Selected Clade</a></li>
<li><a class="nav-link" href="#scale-clade"><span class="header-section-number">6.2</span> Scaling Selected Clade</a></li>
<li><a class="nav-link" href="#collapsing-and-expanding-clade"><span class="header-section-number">6.3</span> Collapsing and Expanding Clade</a></li>
<li><a class="nav-link" href="#group-taxa-vis"><span class="header-section-number">6.4</span> Grouping Taxa</a></li>
<li><a class="nav-link" href="#exploring-tree-structure"><span class="header-section-number">6.5</span> Exploring tree structure</a></li>
<li><a class="nav-link" href="#summary6"><span class="header-section-number">6.6</span> Summary</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Data Integration, Manipulation and Visualization of Phylogenetic Trees</strong>" was written by Guangchuang Yu. It was last built on 2020-11-19.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
