<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 3 Exporting tree with data | Data Integration, Manipulation and Visualization of Phylogenetic Trees</title>
<meta name="author" content="Guangchuang Yu">
<meta name="description" content="3.1 Introduction The treeio package (Wang et al. 2020) supports parsing various phylogenetic tree file formats including software outputs that contain evolutionary evidences. Some of the formats...">
<meta name="generator" content="bookdown 0.23 with bs4_book()">
<meta property="og:title" content="Chapter 3 Exporting tree with data | Data Integration, Manipulation and Visualization of Phylogenetic Trees">
<meta property="og:type" content="book">
<meta property="og:description" content="3.1 Introduction The treeio package (Wang et al. 2020) supports parsing various phylogenetic tree file formats including software outputs that contain evolutionary evidences. Some of the formats...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 3 Exporting tree with data | Data Integration, Manipulation and Visualization of Phylogenetic Trees">
<meta name="twitter:description" content="3.1 Introduction The treeio package (Wang et al. 2020) supports parsing various phylogenetic tree file formats including software outputs that contain evolutionary evidences. Some of the formats...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.10/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/font-awesome-5.3.1/css/fontawesome-all.min.css" rel="stylesheet">
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><script src="libs/pathseg-1.0.2/pathseg.js"></script><script src="libs/comic-0.961/comic.min.js"></script><script src="libs/comicR-binding-0.2/comicR.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Data Integration, Manipulation and Visualization of Phylogenetic Trees</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="introduction.html">Introduction</a></li>
<li class="book-part">Part I: Tree data input, output and manipulation</li>
<li><a class="" href="chapter1.html"><span class="header-section-number">1</span> Importing Tree with Data</a></li>
<li><a class="" href="chapter2.html"><span class="header-section-number">2</span> Manipulating Tree with Data</a></li>
<li><a class="active" href="chapter3.html"><span class="header-section-number">3</span> Exporting tree with data</a></li>
<li class="book-part">Part II: Tree data visualization and annotation</li>
<li><a class="" href="chapter4.html"><span class="header-section-number">4</span> Phylogenetic Tree Visualization</a></li>
<li><a class="" href="chapter5.html"><span class="header-section-number">5</span> Phylogenetic Tree Annotation</a></li>
<li><a class="" href="chapter6.html"><span class="header-section-number">6</span> Visual Exploration of Phylogenetic Tree</a></li>
<li><a class="" href="chapter7.html"><span class="header-section-number">7</span> Plotting tree with data</a></li>
<li><a class="" href="chapter8.html"><span class="header-section-number">8</span> Annotating Tree with Silhouette Images and Sub-plots</a></li>
<li><a class="" href="chapter9.html"><span class="header-section-number">9</span> ggtree for other tree-like objects</a></li>
<li class="book-part">Part III: ggtree extensions</li>
<li><a class="" href="chapter10.html"><span class="header-section-number">10</span> ggtreeExtra for presenting data on circular layout</a></li>
<li><a class="" href="chapter11.html"><span class="header-section-number">11</span> Other ggtree extensions</a></li>
<li class="book-part">Part IV: Miscellaneous topics</li>
<li><a class="" href="chapter12.html"><span class="header-section-number">12</span> ggtree utilities</a></li>
<li><a class="" href="chapter13.html"><span class="header-section-number">13</span> Gallery of reproducible examples</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="faq.html"><span class="header-section-number">A</span> Frequently asked questions</a></li>
<li><a class="" href="related-tools.html"><span class="header-section-number">B</span> Related tools</a></li>
<li><a class="" href="figures-and-tables.html"><span class="header-section-number">C</span> Figures and Tables</a></li>
<li><a class="" href="session-info.html"><span class="header-section-number">D</span> Session Info</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="chapter3" class="section level1" number="3">
<h1>
<span class="header-section-number">3</span> Exporting tree with data<a class="anchor" aria-label="anchor" href="#chapter3"><i class="fas fa-link"></i></a>
</h1>
<div id="introduction-1" class="section level2" number="3.1">
<h2>
<span class="header-section-number">3.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-1"><i class="fas fa-link"></i></a>
</h2>
<p>The <a href="https://bioconductor.org/packages/treeio/">treeio</a> package <span class="citation">(<a href="references.html#ref-wang_treeio_2020" role="doc-biblioref">Wang et al. 2020</a>)</span> supports parsing various phylogenetic tree file formats including software outputs that contain evolutionary evidences. Some of the formats are just log file
(<em>e.g.</em> <a href="http://abacus.gene.ucl.ac.uk/software/paml.html">PAML</a>
and <a href="http://ginger.ucdavis.edu/r8s">r8s</a> outputs), while some of the others are
non-standard formats (<em>e.g.</em> <a href="http://beast2.org/">BEAST</a>
and <a href="http://nbisweden.github.io/MrBayes/">MrBayes</a> outputs that introduce square
bracket, which was reserved to store comment in standard Nexus format, to store
inferences). With <a href="https://bioconductor.org/packages/treeio/">treeio</a>, we are
now able to parse these files to extract phylogenetic tree and map associated
data on the tree structure. Exporting tree structure is easy, users can use
the <code>as.phyo()</code> method defined <a href="https://bioconductor.org/packages/treeio/">treeio</a> to
convert a <code>treedata</code> object to a <code>phylo</code> object then using <code><a href="https://rdrr.io/pkg/ape/man/write.tree.html">write.tree()</a></code> or
<code><a href="https://rdrr.io/pkg/ape/man/write.nexus.html">write.nexus()</a></code> implemented
in <a href="https://cran.r-project.org/web/packages/ape/index.html">ape</a> package
<span class="citation">(<a href="references.html#ref-paradis_ape_2004" role="doc-biblioref">Paradis, Claude, and Strimmer 2004</a>)</span> to export the tree structure as Newick text or Nexus file.
This is quite useful for converting non-standard formats to standard format and
for extracting tree from software outputs, such as log file.</p>
<p>However, exporting tree with associated data is still challenging. These
associated data can be parsed from analysis programs or obtained from external
sources (<em>e.g.</em> phenotypic data, experimental data and clinical data). The major
obstacle here is that there is no standard format that designed for storing
tree with data. <a href="http://www.nexml.org/">NeXML</a> <span class="citation">(<a href="references.html#ref-vos_nexml:_2012" role="doc-biblioref">Vos et al. 2012</a>)</span> maybe the most
flexible format, however it is currently not widely supported. Most of the
analysis programs in this field rely extensively on Newick string and Nexus
format. In my opinion, although <a href="http://beast.community/nexus_metacomments">BEAST Nexus
format</a> may not be the best solution,
it is currently a good approach for storing heterogeneous associated data. The
beauty of the format is that all the annotate elements are stored within square
bracket, which is reserved for comments. So that the file can be parsed as
standard Nexus by ignoring annotated elements and existing programs should be
able to read it.</p>
</div>
<div id="exporting-tree-data-to-beast-nexus-format" class="section level2" number="3.2">
<h2>
<span class="header-section-number">3.2</span> Exporting Tree Data to <em>BEAST</em> Nexus Format<a class="anchor" aria-label="anchor" href="#exporting-tree-data-to-beast-nexus-format"><i class="fas fa-link"></i></a>
</h2>
<div id="exportingconverting-software-output" class="section level3" number="3.2.1">
<h3>
<span class="header-section-number">3.2.1</span> Exporting/converting software output<a class="anchor" aria-label="anchor" href="#exportingconverting-software-output"><i class="fas fa-link"></i></a>
</h3>
<p>The <a href="https://bioconductor.org/packages/treeio/">treeio</a> package <span class="citation">(<a href="references.html#ref-wang_treeio_2020" role="doc-biblioref">Wang et al. 2020</a>)</span> provides the <code><a href="https://docs.ropensci.org/treeio/reference/write.beast.html">write.beast()</a></code> function to export <code>treedata</code> object as BEAST Nexus file <span class="citation">(<a href="references.html#ref-bouckaert_beast_2014" role="doc-biblioref">Bouckaert et al. 2014</a>)</span>.
With <a href="https://bioconductor.org/packages/treeio/">treeio</a>, it is easy to convert
software output to BEAST format if the output can be parsed
by <a href="https://bioconductor.org/packages/treeio/">treeio</a> (see <a href="chapter1.html#chapter1">Chapter 1</a>). For example, we can
convert NHX file to BEAST file and use NHX tags to color the tree using
<a href="http://beast.community/figtree">FigTree</a> (Figure <a href="chapter3.html#fig:beastFigtree">3.1</a>A) or convert CODEML output and use
<em>d<sub>N</sub>/d<sub>S</sub></em>, <em>d<sub>N</sub></em> or <em>d<sub>S</sub></em> to color the tree in FigTree (Figure <a href="chapter3.html#fig:beastFigtree">3.1</a>B).</p>
<p>Here is an example of converting NHX file to BEAST format:</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nhxfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/NHX"</span>, <span class="st">"phyldog.nhx"</span>, package<span class="op">=</span><span class="st">"treeio"</span><span class="op">)</span>
<span class="va">nhx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/treeio/reference/read.nhx.html">read.nhx</a></span><span class="op">(</span><span class="va">nhxfile</span><span class="op">)</span>
<span class="co"># write.beast(nhx, file = "phyldog.tree")</span>
<span class="fu"><a href="https://docs.ropensci.org/treeio/reference/write.beast.html">write.beast</a></span><span class="op">(</span><span class="va">nhx</span><span class="op">)</span></code></pre></div>
<pre><code>#NEXUS
[R-package treeio, Thu Sep  2 09:38:23 2021]

BEGIN TAXA;
    DIMENSIONS NTAX = 16;
    TAXLABELS
        Prayidae_D27SS7@2825365
        Kephyes_ovata@2606431
        Chuniphyes_multidentata@1277217
        Apolemia_sp_@1353964
        Bargmannia_amoena@263997
        Bargmannia_elongata@946788
        Physonect_sp_@2066767
        Stephalia_dilata@2960089
        Frillagalma_vityazi@1155031
        Resomia_ornicephala@3111757
        Lychnagalma_utricularia@2253871
        Nanomia_bijuga@717864
        Cordagalma_sp_@1525873
        Rhizophysa_filiformis@3073669
        Hydra_magnipapillata@52244
        Ectopleura_larynx@3556167
    ;
END;
BEGIN TREES;
    TRANSLATE
        1   Prayidae_D27SS7@2825365,
        2   Kephyes_ovata@2606431,
        3   Chuniphyes_multidentata@1277217,
        4   Apolemia_sp_@1353964,
        5   Bargmannia_amoena@263997,
        6   Bargmannia_elongata@946788,
        7   Physonect_sp_@2066767,
        8   Stephalia_dilata@2960089,
        9   Frillagalma_vityazi@1155031,
        10  Resomia_ornicephala@3111757,
        11  Lychnagalma_utricularia@2253871,
        12  Nanomia_bijuga@717864,
        13  Cordagalma_sp_@1525873,
        14  Rhizophysa_filiformis@3073669,
        15  Hydra_magnipapillata@52244,
        16  Ectopleura_larynx@3556167
    ;
    TREE * UNTITLED = [&amp;R] (((1[&amp;Ev=S,ND=0,S=58]:0.0682841,(2[&amp;Ev=S,ND=1,S=69]:0.0193941,3[&amp;Ev=S,ND=2,S=70]:0.0121378)[&amp;Ev=S,ND=3,S=60]:0.0217782)[&amp;Ev=S,ND=4,S=36]:0.0607598,((4[&amp;Ev=S,ND=9,S=31]:0.11832,(((5[&amp;Ev=S,ND=10,S=37]:0.0144549,6[&amp;Ev=S,ND=11,S=38]:0.0149723)[&amp;Ev=S,ND=12,S=33]:0.0925388,7[&amp;Ev=S,ND=13,S=61]:0.077429)[&amp;Ev=S,ND=14,S=24]:0.0274637,(8[&amp;Ev=S,ND=15,S=52]:0.0761163,((9[&amp;Ev=S,ND=16,S=53]:0.0906068,10[&amp;Ev=S,ND=17,S=54]:1e-06)[&amp;Ev=S,ND=18,S=45]:1e-06,((11[&amp;Ev=S,ND=19,S=65]:0.120851,12[&amp;Ev=S,ND=20,S=71]:0.133939)[&amp;Ev=S,ND=21,S=56]:1e-06,13[&amp;Ev=S,ND=22,S=64]:0.0693814)[&amp;Ev=S,ND=23,S=46]:1e-06)[&amp;Ev=S,ND=24,S=40]:0.0333823)[&amp;Ev=S,ND=25,S=35]:1e-06)[&amp;Ev=D,ND=26,S=24]:0.0431861)[&amp;Ev=S,ND=27,S=19]:1e-06,14[&amp;Ev=S,ND=28,S=26]:0.22283)[&amp;Ev=S,ND=29,S=17]:0.0292362)[&amp;Ev=D,ND=8,S=17]:0.185603,(15[&amp;Ev=S,ND=5,S=16]:0.0621782,16[&amp;Ev=S,ND=6,S=15]:0.332505)[&amp;Ev=S,ND=7,S=12]:0.185603)[&amp;Ev=S,ND=30,S=9];
END;</code></pre>
<p>Another example of converting CodeML output to BEAST format:</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mlcfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/PAML_Codeml"</span>, <span class="st">"mlc"</span>, package<span class="op">=</span><span class="st">"treeio"</span><span class="op">)</span>
<span class="va">ml</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/treeio/reference/read.codeml_mlc.html">read.codeml_mlc</a></span><span class="op">(</span><span class="va">mlcfile</span><span class="op">)</span>
<span class="co"># write.beast(ml, file = "codeml.tree")</span>
<span class="fu"><a href="https://docs.ropensci.org/treeio/reference/write.beast.html">write.beast</a></span><span class="op">(</span><span class="va">ml</span><span class="op">)</span></code></pre></div>
<pre><code>#NEXUS
[R-package treeio, Thu Sep  2 09:38:23 2021]

BEGIN TAXA;
    DIMENSIONS NTAX = 15;
    TAXLABELS
        A
        B
        C
        D
        E
        F
        G
        H
        I
        J
        K
        L
        M
        N
        O
    ;
END;
BEGIN TREES;
    TRANSLATE
        1   A,
        2   B,
        3   C,
        4   D,
        5   E,
        6   F,
        7   G,
        8   H,
        9   I,
        10  J,
        11  K,
        12  L,
        13  M,
        14  N,
        15  O
    ;
    TREE * UNTITLED = [&amp;U] (11[&amp;t=0.082,N=1514.9,S=633.1,dN_vs_dS=0.0224,dN=0.002,dS=0.0878,N_x_dN=3,S_x_dS=55.6]:0.081785,14[&amp;t=0.062,N=1514.9,S=633.1,dN_vs_dS=0.0095,dN=7e-04,dS=0.0689,N_x_dN=1,S_x_dS=43.6]:0.062341,(4[&amp;t=0.082,N=1514.9,S=633.1,dN_vs_dS=0.0385,dN=0.0033,dS=0.0849,N_x_dN=5,S_x_dS=53.8]:0.082021,(12[&amp;t=0.006,N=1514.9,S=633.1,dN_vs_dS=1e-04,dN=0,dS=0.0062,N_x_dN=0,S_x_dS=3.9]:0.005508,(10[&amp;t=0.014,N=1514.9,S=633.1,dN_vs_dS=0.0457,dN=7e-04,dS=0.0143,N_x_dN=1,S_x_dS=9]:0.013996,(7[&amp;t=0.046,N=1514.9,S=633.1,dN_vs_dS=0.1621,dN=0.006,dS=0.0373,N_x_dN=9.2,S_x_dS=23.6]:0.045746,((3[&amp;t=0.028,N=1514.9,S=633.1,dN_vs_dS=0.0461,dN=0.0013,dS=0.0282,N_x_dN=2,S_x_dS=17.9]:0.02773,(5[&amp;t=0.031,N=1514.9,S=633.1,dN_vs_dS=0.0641,dN=0.002,dS=0.0305,N_x_dN=3,S_x_dS=19.3]:0.031104,15[&amp;t=0.048,N=1514.9,S=633.1,dN_vs_dS=0.0538,dN=0.0026,dS=0.0485,N_x_dN=4,S_x_dS=30.7]:0.048389)23[&amp;t=0.008,N=1514.9,S=633.1,dN_vs_dS=1e-04,dN=0,dS=0.0094,N_x_dN=0,S_x_dS=6]:0.008328)22[&amp;t=0.016,N=1514.9,S=633.1,dN_vs_dS=0.0395,dN=7e-04,dS=0.0165,N_x_dN=1,S_x_dS=10.4]:0.015959,(8[&amp;t=0.021,N=1514.9,S=633.1,dN_vs_dS=0.1028,dN=0.002,dS=0.0191,N_x_dN=3,S_x_dS=12.1]:0.021007,(9[&amp;t=0.015,N=1514.9,S=633.1,dN_vs_dS=1e-04,dN=0,dS=0.0167,N_x_dN=0,S_x_dS=10.6]:0.014739,(2[&amp;t=0.032,N=1514.9,S=633.1,dN_vs_dS=1e-04,dN=0,dS=0.0358,N_x_dN=0,S_x_dS=22.7]:0.031643,(1[&amp;t=0.01,N=1514.9,S=633.1,dN_vs_dS=0.0646,dN=7e-04,dS=0.0101,N_x_dN=1,S_x_dS=6.4]:0.01034,(6[&amp;t=0.007,N=1514.9,S=633.1,dN_vs_dS=0.298,dN=0.0013,dS=0.0044,N_x_dN=2,S_x_dS=2.8]:0.006649,13[&amp;t=0.009,N=1514.9,S=633.1,dN_vs_dS=0.0738,dN=7e-04,dS=0.0088,N_x_dN=1,S_x_dS=5.6]:0.009195)28[&amp;t=0.028,N=1514.9,S=633.1,dN_vs_dS=0.0453,dN=0.0013,dS=0.0289,N_x_dN=2,S_x_dS=18.3]:0.028303)27[&amp;t=0.008,N=1514.9,S=633.1,dN_vs_dS=0.0863,dN=7e-04,dS=0.0076,N_x_dN=1,S_x_dS=4.8]:0.008072)26[&amp;t=0.003,N=1514.9,S=633.1,dN_vs_dS=1.5591,dN=0.0013,dS=8e-04,N_x_dN=2,S_x_dS=0.5]:0.0035)25[&amp;t=0.02,N=1514.9,S=633.1,dN_vs_dS=1e-04,dN=0,dS=0.023,N_x_dN=0,S_x_dS=14.6]:0.020359)24[&amp;t=0.001,N=1514.9,S=633.1,dN_vs_dS=1e-04,dN=0,dS=6e-04,N_x_dN=0,S_x_dS=0.4]:0.000555)21[&amp;t=0.024,N=1514.9,S=633.1,dN_vs_dS=0.0549,dN=0.0013,dS=0.0237,N_x_dN=2,S_x_dS=15]:0.023675)20[&amp;t=0.046,N=1514.9,S=633.1,dN_vs_dS=0.0419,dN=0.002,dS=0.047,N_x_dN=3,S_x_dS=29.8]:0.045745)19[&amp;t=0.015,N=1514.9,S=633.1,dN_vs_dS=1e-04,dN=0,dS=0.0166,N_x_dN=0,S_x_dS=10.5]:0.014684)18[&amp;t=0.059,N=1514.9,S=633.1,dN_vs_dS=0.0964,dN=0.0053,dS=0.0545,N_x_dN=8,S_x_dS=34.5]:0.059308)17[&amp;t=0.232,N=1514.9,S=633.1,dN_vs_dS=0.0129,dN=0.0033,dS=0.2541,N_x_dN=5,S_x_dS=160.9]:0.231628)16;
END;</code></pre>


<div class="figure">
<span style="display:block;" id="fig:beastFigtree"></span>
<img src="treedata_files/figure-html/beastFigtree-1.svg" alt="Visualizing BEAST file in FigTree. Directly visualizing NHX file (A) and CodeML output (B) in FigTree is not supported. treeio can convert these files to BEAST compatible NEXUS format which can be directly opened in FigTree and visualized annotated data." width="100%"><p class="caption">
Figure 3.1: <strong>Visualizing BEAST file in FigTree.</strong> Directly visualizing <code>NHX</code> file (A) and <code>CodeML</code> output (B) in <code>FigTree</code> is not supported. <code>treeio</code> can convert these files to BEAST compatible NEXUS format which can be directly opened in <code>FigTree</code> and visualized annotated data.
</p>
</div>
</div>
<div id="combining-tree-with-external-data" class="section level3" number="3.2.2">
<h3>
<span class="header-section-number">3.2.2</span> Combining tree with external data<a class="anchor" aria-label="anchor" href="#combining-tree-with-external-data"><i class="fas fa-link"></i></a>
</h3>
<p>Using the utilities provided
by <a href="https://CRAN.R-project.org/package=tidytree">tidytree</a> and <a href="https://bioconductor.org/packages/treeio/">treeio</a>, it is easy to link
external data onto the corresponding phylogeny. The <code><a href="https://docs.ropensci.org/treeio/reference/write.beast.html">write.beast()</a></code> function enables users to export the tree with external data to a single tree file.</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">phylo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/as.phylo.html">as.phylo</a></span><span class="op">(</span><span class="va">nhx</span><span class="op">)</span>
<span class="co">## print the newick text</span>
<span class="fu"><a href="https://rdrr.io/pkg/ape/man/write.tree.html">write.tree</a></span><span class="op">(</span><span class="va">phylo</span><span class="op">)</span></code></pre></div>
<pre><code>[1] "(((Prayidae_D27SS7@2825365:0.0682841,(Kephyes_ovata@2606431:0.0193941,Chuniphyes_multidentata@1277217:0.0121378):0.0217782):0.0607598,((Apolemia_sp_@1353964:0.11832,(((Bargmannia_amoena@263997:0.0144549,Bargmannia_elongata@946788:0.0149723):0.0925388,Physonect_sp_@2066767:0.077429):0.0274637,(Stephalia_dilata@2960089:0.0761163,((Frillagalma_vityazi@1155031:0.0906068,Resomia_ornicephala@3111757:1e-06):1e-06,((Lychnagalma_utricularia@2253871:0.120851,Nanomia_bijuga@717864:0.133939):1e-06,Cordagalma_sp_@1525873:0.0693814):1e-06):0.0333823):1e-06):0.0431861):1e-06,Rhizophysa_filiformis@3073669:0.22283):0.0292362):0.185603,(Hydra_magnipapillata@52244:0.0621782,Ectopleura_larynx@3556167:0.332505):0.185603);"</code></pre>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/treeio/reference/getNodeNum.html">Nnode2</a></span><span class="op">(</span><span class="va">phylo</span><span class="op">)</span>
<span class="va">fake_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tibble/man/tibble.html">tibble</a></span><span class="op">(</span>node <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span>, fake_trait <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, another_trait <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span>
<span class="va">fake_tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">phylo</span>, <span class="va">fake_data</span>, by <span class="op">=</span> <span class="st">"node"</span><span class="op">)</span>
<span class="fu"><a href="https://docs.ropensci.org/treeio/reference/write.beast.html">write.beast</a></span><span class="op">(</span><span class="va">fake_tree</span><span class="op">)</span></code></pre></div>
<pre><code>#NEXUS
[R-package treeio, Thu Sep  2 09:38:26 2021]

BEGIN TAXA;
    DIMENSIONS NTAX = 16;
    TAXLABELS
        Prayidae_D27SS7@2825365
        Kephyes_ovata@2606431
        Chuniphyes_multidentata@1277217
        Apolemia_sp_@1353964
        Bargmannia_amoena@263997
        Bargmannia_elongata@946788
        Physonect_sp_@2066767
        Stephalia_dilata@2960089
        Frillagalma_vityazi@1155031
        Resomia_ornicephala@3111757
        Lychnagalma_utricularia@2253871
        Nanomia_bijuga@717864
        Cordagalma_sp_@1525873
        Rhizophysa_filiformis@3073669
        Hydra_magnipapillata@52244
        Ectopleura_larynx@3556167
    ;
END;
BEGIN TREES;
    TRANSLATE
        1   Prayidae_D27SS7@2825365,
        2   Kephyes_ovata@2606431,
        3   Chuniphyes_multidentata@1277217,
        4   Apolemia_sp_@1353964,
        5   Bargmannia_amoena@263997,
        6   Bargmannia_elongata@946788,
        7   Physonect_sp_@2066767,
        8   Stephalia_dilata@2960089,
        9   Frillagalma_vityazi@1155031,
        10  Resomia_ornicephala@3111757,
        11  Lychnagalma_utricularia@2253871,
        12  Nanomia_bijuga@717864,
        13  Cordagalma_sp_@1525873,
        14  Rhizophysa_filiformis@3073669,
        15  Hydra_magnipapillata@52244,
        16  Ectopleura_larynx@3556167
    ;
    TREE * UNTITLED = [&amp;R] (((1[&amp;fake_trait=0.810266619540347,another_trait=0.0979642828460783]:0.0682841,(2[&amp;fake_trait=1.04780592797913,another_trait=0.255336594535038]:0.0193941,3[&amp;fake_trait=-0.525315388149907,another_trait=0.0768492061179131]:0.0121378)[&amp;fake_trait=1.14511328541082,another_trait=0.341676945565268]:0.0217782)[&amp;fake_trait=1.47263175562671,another_trait=0.597173389280215]:0.0607598,(14[&amp;fake_trait=-0.180105407408332,another_trait=0.405489857308567]:0.22283,(4[&amp;fake_trait=1.25678468744393,another_trait=0.286884719505906]:0.11832,((7[&amp;fake_trait=0.730359059846483,another_trait=0.497727471170947]:0.077429,(5[&amp;fake_trait=1.25879013291401,another_trait=0.878254126058891]:0.0144549,6[&amp;fake_trait=0.239815595891983,another_trait=0.379190814914182]:0.0149723)[&amp;fake_trait=2.56125226634243,another_trait=0.432879082160071]:0.0925388)[&amp;fake_trait=0.873442969677915,another_trait=0.13348799967207]:0.0274637,(8[&amp;fake_trait=1.33865819182797,another_trait=0.787276627961546]:0.0761163,((9[&amp;fake_trait=-0.791364091701768,another_trait=0.437938967952505]:0.0906068,10[&amp;fake_trait=0.154576264658977,another_trait=0.10230500344187]:1e-06)[&amp;fake_trait=-0.18939020426446,another_trait=0.154172978363931]:1e-06,(13[&amp;fake_trait=0.953691105265616,another_trait=0.113366388017312]:0.0693814,(11[&amp;fake_trait=0.52571254882219,another_trait=0.911556096747518]:0.120851,12[&amp;fake_trait=-0.923096859920575,another_trait=0.944086311617866]:0.133939)[&amp;fake_trait=-0.592732979571578,another_trait=0.509087640792131]:1e-06)[&amp;fake_trait=-0.30156227532438,another_trait=0.591121553909034]:1e-06)[&amp;fake_trait=-0.213737440972264,another_trait=0.828644473804161]:0.0333823)[&amp;fake_trait=0.610056903753043,another_trait=0.710706093581393]:1e-06)[&amp;fake_trait=-0.902209722316081,another_trait=0.944954794365913]:0.0431861)[&amp;fake_trait=0.0949525197413311,another_trait=0.108365619787946]:1e-06)[&amp;fake_trait=-1.90680389611356,another_trait=0.117206424707547]:0.0292362)[&amp;fake_trait=-0.0330343850713759,another_trait=0.0023308175150305]:0.185603,(15[&amp;fake_trait=1.25577887603495,another_trait=0.427273260196671]:0.0621782,16[&amp;fake_trait=0.738593081465311,another_trait=0.620253301691264]:0.332505)[&amp;fake_trait=0.7259159692824,another_trait=0.90451981080696]:0.185603)[&amp;fake_trait=-0.270961007065714,another_trait=0.966370139736682];
END;</code></pre>
<p>After merging, the <code>fake_trait</code> and <code>another_trait</code> stored in <code>fake_data</code> will be linked to the tree, <code>phylo</code>, and store in the <code>treedata</code> object, the <code>fake_tree</code>. The <code><a href="https://docs.ropensci.org/treeio/reference/write.beast.html">write.beast()</a></code> function export the tree with associated data to a single BEAST format file. The associated data can be used to visualized the tree using <a href="http://bioconductor.org/packages/ggtree">ggtree</a> (Figure <a href="chapter5.html#fig:beast">5.7</a>) or <code>FigTree</code> (Figure <a href="chapter3.html#fig:beastFigtree">3.1</a>).</p>
</div>
<div id="merging-tree-data-from-different-sources" class="section level3" number="3.2.3">
<h3>
<span class="header-section-number">3.2.3</span> Merging tree data from different sources<a class="anchor" aria-label="anchor" href="#merging-tree-data-from-different-sources"><i class="fas fa-link"></i></a>
</h3>
<p>Not only Newick tree text can be combined with associated data, but also tree
data obtained from software output can be combined with external data, as well
as different tree objects can be merged together (for details, see <a href="chapter2.html#chapter2">Chapter 2</a>).</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## combine tree object with data</span>
<span class="va">tree_with_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">nhx</span>, <span class="va">fake_data</span>, by <span class="op">=</span> <span class="st">"node"</span><span class="op">)</span>
<span class="va">tree_with_data</span></code></pre></div>
<pre><code>## 'treedata' S4 object that stored information of
##  '/home/ygc/R/library/treeio/extdata/NHX/phyldog.nhx'.
## 
## ...@ phylo:
## 
## Phylogenetic tree with 16 tips and 15 internal nodes.
## 
## Tip labels:
##   Prayidae_D27SS7@2825365, Kephyes_ovata@2606431, Chuniphyes_multidentata@1277217, Apolemia_sp_@1353964, Bargmannia_amoena@263997, Bargmannia_elongata@946788, ...
## 
## Rooted; includes branch lengths.
## 
## with the following features available:
##  'Ev',   'ND',   'S',    'fake_trait',   'another_trait'.
## 
## # The associated data tibble abstraction: 31 × 8
## # The 'node', 'label' and 'isTip' are from the phylo tree.
##     node label            isTip Ev       ND     S fake_trait
##    &lt;int&gt; &lt;chr&gt;            &lt;lgl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
##  1     1 Prayidae_D27SS7… TRUE  S         0    58      0.810
##  2     2 Kephyes_ovata@2… TRUE  S         1    69      1.05 
##  3     3 Chuniphyes_mult… TRUE  S         2    70     -0.525
##  4     4 Apolemia_sp_@13… TRUE  S         9    31      1.26 
##  5     5 Bargmannia_amoe… TRUE  S        10    37      1.26 
##  6     6 Bargmannia_elon… TRUE  S        11    38      0.240
##  7     7 Physonect_sp_@2… TRUE  S        13    61      0.730
##  8     8 Stephalia_dilat… TRUE  S        15    52      1.34 
##  9     9 Frillagalma_vit… TRUE  S        16    53     -0.791
## 10    10 Resomia_ornicep… TRUE  S        17    54      0.155
## # … with 21 more rows, and 1 more variable:
## #   another_trait &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## merge two tree object</span>
<span class="va">tree2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/treeio/reference/merge_tree.html">merge_tree</a></span><span class="op">(</span><span class="va">nhx</span>, <span class="va">fake_tree</span><span class="op">)</span>
<span class="va">tree2</span></code></pre></div>
<pre><code>## 'treedata' S4 object that stored information of
##  '/home/ygc/R/library/treeio/extdata/NHX/phyldog.nhx'.
## 
## ...@ phylo:
## 
## Phylogenetic tree with 16 tips and 15 internal nodes.
## 
## Tip labels:
##   Prayidae_D27SS7@2825365, Kephyes_ovata@2606431, Chuniphyes_multidentata@1277217, Apolemia_sp_@1353964, Bargmannia_amoena@263997, Bargmannia_elongata@946788, ...
## 
## Rooted; includes branch lengths.
## 
## with the following features available:
##  'Ev',   'ND',   'S',    'fake_trait',   'another_trait'.
## 
## # The associated data tibble abstraction: 31 × 8
## # The 'node', 'label' and 'isTip' are from the phylo tree.
##     node label            isTip Ev       ND     S fake_trait
##    &lt;int&gt; &lt;chr&gt;            &lt;lgl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
##  1     1 Prayidae_D27SS7… TRUE  S         0    58      0.810
##  2     2 Kephyes_ovata@2… TRUE  S         1    69      1.05 
##  3     3 Chuniphyes_mult… TRUE  S         2    70     -0.525
##  4     4 Apolemia_sp_@13… TRUE  S         9    31      1.26 
##  5     5 Bargmannia_amoe… TRUE  S        10    37      1.26 
##  6     6 Bargmannia_elon… TRUE  S        11    38      0.240
##  7     7 Physonect_sp_@2… TRUE  S        13    61      0.730
##  8     8 Stephalia_dilat… TRUE  S        15    52      1.34 
##  9     9 Frillagalma_vit… TRUE  S        16    53     -0.791
## 10    10 Resomia_ornicep… TRUE  S        17    54      0.155
## # … with 21 more rows, and 1 more variable:
## #   another_trait &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">tree_with_data</span>, <span class="va">tree2</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>After merging data from different sources, the tree with the associated data can
be exported into a single file.</p>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/treeio/reference/write.beast.html">write.beast</a></span><span class="op">(</span><span class="va">tree2</span><span class="op">)</span></code></pre></div>
<pre><code>#NEXUS
[R-package treeio, Thu Sep  2 09:38:26 2021]

BEGIN TAXA;
    DIMENSIONS NTAX = 16;
    TAXLABELS
        Prayidae_D27SS7@2825365
        Kephyes_ovata@2606431
        Chuniphyes_multidentata@1277217
        Apolemia_sp_@1353964
        Bargmannia_amoena@263997
        Bargmannia_elongata@946788
        Physonect_sp_@2066767
        Stephalia_dilata@2960089
        Frillagalma_vityazi@1155031
        Resomia_ornicephala@3111757
        Lychnagalma_utricularia@2253871
        Nanomia_bijuga@717864
        Cordagalma_sp_@1525873
        Rhizophysa_filiformis@3073669
        Hydra_magnipapillata@52244
        Ectopleura_larynx@3556167
    ;
END;
BEGIN TREES;
    TRANSLATE
        1   Prayidae_D27SS7@2825365,
        2   Kephyes_ovata@2606431,
        3   Chuniphyes_multidentata@1277217,
        4   Apolemia_sp_@1353964,
        5   Bargmannia_amoena@263997,
        6   Bargmannia_elongata@946788,
        7   Physonect_sp_@2066767,
        8   Stephalia_dilata@2960089,
        9   Frillagalma_vityazi@1155031,
        10  Resomia_ornicephala@3111757,
        11  Lychnagalma_utricularia@2253871,
        12  Nanomia_bijuga@717864,
        13  Cordagalma_sp_@1525873,
        14  Rhizophysa_filiformis@3073669,
        15  Hydra_magnipapillata@52244,
        16  Ectopleura_larynx@3556167
    ;
    TREE * UNTITLED = [&amp;R] (((1[&amp;Ev=S,ND=0,S=58,fake_trait=0.810266619540347,another_trait=0.0979642828460783]:0.0682841,(2[&amp;Ev=S,ND=1,S=69,fake_trait=1.04780592797913,another_trait=0.255336594535038]:0.0193941,3[&amp;Ev=S,ND=2,S=70,fake_trait=-0.525315388149907,another_trait=0.0768492061179131]:0.0121378)[&amp;Ev=S,ND=3,S=60,fake_trait=1.14511328541082,another_trait=0.341676945565268]:0.0217782)[&amp;Ev=S,ND=4,S=36,fake_trait=1.47263175562671,another_trait=0.597173389280215]:0.0607598,((4[&amp;Ev=S,ND=9,S=31,fake_trait=1.25678468744393,another_trait=0.286884719505906]:0.11832,(((5[&amp;Ev=S,ND=10,S=37,fake_trait=1.25879013291401,another_trait=0.878254126058891]:0.0144549,6[&amp;Ev=S,ND=11,S=38,fake_trait=0.239815595891983,another_trait=0.379190814914182]:0.0149723)[&amp;Ev=S,ND=12,S=33,fake_trait=2.56125226634243,another_trait=0.432879082160071]:0.0925388,7[&amp;Ev=S,ND=13,S=61,fake_trait=0.730359059846483,another_trait=0.497727471170947]:0.077429)[&amp;Ev=S,ND=14,S=24,fake_trait=0.873442969677915,another_trait=0.13348799967207]:0.0274637,(8[&amp;Ev=S,ND=15,S=52,fake_trait=1.33865819182797,another_trait=0.787276627961546]:0.0761163,((9[&amp;Ev=S,ND=16,S=53,fake_trait=-0.791364091701768,another_trait=0.437938967952505]:0.0906068,10[&amp;Ev=S,ND=17,S=54,fake_trait=0.154576264658977,another_trait=0.10230500344187]:1e-06)[&amp;Ev=S,ND=18,S=45,fake_trait=-0.18939020426446,another_trait=0.154172978363931]:1e-06,((11[&amp;Ev=S,ND=19,S=65,fake_trait=0.52571254882219,another_trait=0.911556096747518]:0.120851,12[&amp;Ev=S,ND=20,S=71,fake_trait=-0.923096859920575,another_trait=0.944086311617866]:0.133939)[&amp;Ev=S,ND=21,S=56,fake_trait=-0.592732979571578,another_trait=0.509087640792131]:1e-06,13[&amp;Ev=S,ND=22,S=64,fake_trait=0.953691105265616,another_trait=0.113366388017312]:0.0693814)[&amp;Ev=S,ND=23,S=46,fake_trait=-0.30156227532438,another_trait=0.591121553909034]:1e-06)[&amp;Ev=S,ND=24,S=40,fake_trait=-0.213737440972264,another_trait=0.828644473804161]:0.0333823)[&amp;Ev=S,ND=25,S=35,fake_trait=0.610056903753043,another_trait=0.710706093581393]:1e-06)[&amp;Ev=D,ND=26,S=24,fake_trait=-0.902209722316081,another_trait=0.944954794365913]:0.0431861)[&amp;Ev=S,ND=27,S=19,fake_trait=0.0949525197413311,another_trait=0.108365619787946]:1e-06,14[&amp;Ev=S,ND=28,S=26,fake_trait=-0.180105407408332,another_trait=0.405489857308567]:0.22283)[&amp;Ev=S,ND=29,S=17,fake_trait=-1.90680389611356,another_trait=0.117206424707547]:0.0292362)[&amp;Ev=D,ND=8,S=17,fake_trait=-0.0330343850713759,another_trait=0.0023308175150305]:0.185603,(15[&amp;Ev=S,ND=5,S=16,fake_trait=1.25577887603495,another_trait=0.427273260196671]:0.0621782,16[&amp;Ev=S,ND=6,S=15,fake_trait=0.738593081465311,another_trait=0.620253301691264]:0.332505)[&amp;Ev=S,ND=7,S=12,fake_trait=0.7259159692824,another_trait=0.90451981080696]:0.185603)[&amp;Ev=S,ND=30,S=9,fake_trait=-0.270961007065714,another_trait=0.966370139736682];
END;</code></pre>
<p>The output BEAST Nexus file can be imported into R using the <code>read.beast</code>
function and all the associated data can be used to annotate the tree
using <a href="https://bioconductor.org/packages/ggtree/">ggtree</a> <span class="citation">(<a href="references.html#ref-yu_ggtree:_2017" role="doc-biblioref">Yu et al. 2017</a>)</span>.</p>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">outfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".tree"</span><span class="op">)</span>
<span class="fu"><a href="https://docs.ropensci.org/treeio/reference/write.beast.html">write.beast</a></span><span class="op">(</span><span class="va">tree2</span>, file <span class="op">=</span> <span class="va">outfile</span><span class="op">)</span>
<span class="fu"><a href="https://docs.ropensci.org/treeio/reference/beast-parser.html">read.beast</a></span><span class="op">(</span><span class="va">outfile</span><span class="op">)</span></code></pre></div>
<pre><code>## 'treedata' S4 object that stored information of
##  '/tmp/RtmpEM0F0I/file6786aa55377.tree'.
## 
## ...@ phylo:
## 
## Phylogenetic tree with 16 tips and 15 internal nodes.
## 
## Tip labels:
##   Prayidae_D27SS7@2825365, Kephyes_ovata@2606431, Chuniphyes_multidentata@1277217, Apolemia_sp_@1353964, Bargmannia_amoena@263997, Bargmannia_elongata@946788, ...
## 
## Rooted; includes branch lengths.
## 
## with the following features available:
##  'another_trait',    'Ev',   'fake_trait',   'ND',   'S'.
## 
## # The associated data tibble abstraction: 31 × 8
## # The 'node', 'label' and 'isTip' are from the phylo tree.
##     node label   isTip another_trait  Ev    fake_trait ND   
##    &lt;int&gt; &lt;chr&gt;   &lt;lgl&gt; &lt;chr&gt;          &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;
##  1     1 Prayid… TRUE  0.09796428284… S     0.8102666… 0    
##  2     2 Kephye… TRUE  0.25533659453… S     1.0478059… 1    
##  3     3 Chunip… TRUE  0.07684920611… S     -0.525315… 2    
##  4     4 Apolem… TRUE  0.28688471950… S     1.2567846… 9    
##  5     5 Bargma… TRUE  0.87825412605… S     1.2587901… 10   
##  6     6 Bargma… TRUE  0.37919081491… S     0.2398155… 11   
##  7     7 Physon… TRUE  0.49772747117… S     0.7303590… 13   
##  8     8 Stepha… TRUE  0.78727662796… S     1.3386581… 15   
##  9     9 Frilla… TRUE  0.43793896795… S     -0.791364… 16   
## 10    10 Resomi… TRUE  0.10230500344… S     0.1545762… 17   
## # … with 21 more rows, and 1 more variable: S &lt;chr&gt;</code></pre>
</div>
</div>
<div id="write-jtree" class="section level2" number="3.3">
<h2>
<span class="header-section-number">3.3</span> Exporting Tree Data to <em>jtree</em> Format<a class="anchor" aria-label="anchor" href="#write-jtree"><i class="fas fa-link"></i></a>
</h2>
<p>The <a href="https://bioconductor.org/packages/treeio/">treeio</a> package <span class="citation">(<a href="references.html#ref-wang_treeio_2020" role="doc-biblioref">Wang et al. 2020</a>)</span> provides the
<code><a href="https://docs.ropensci.org/treeio/reference/write.beast.html">write.beast()</a></code> function to export <code>treedata</code> to BEAST Nexus file. This is quite useful
to convert file format, combine tree with data and merge tree data from
different sources as we demonstrated in
<a href="chapter3.html#exporting-tree-data-to-beast-nexus-format">session 3.2</a>.
The <a href="https://bioconductor.org/packages/treeio/">treeio</a> package also supplies
the <code><a href="https://docs.ropensci.org/treeio/reference/beast-parser.html">read.beast()</a></code> function to parse output file of the <code><a href="https://docs.ropensci.org/treeio/reference/write.beast.html">write.beast()</a></code> function. Although
with <a href="https://bioconductor.org/packages/treeio/">treeio</a>, the R community has the ability to
manipulate BEAST Nexus format and process tree data, there is still lacking
library/package for parsing BEAST file in other programming language.</p>
<p><a href="https://www.json.org/">JSON</a> (JavaScript Object Notation) is a lightweight data-interchange format and
widely supported in almost all modern programming languages. To make it easy
to import tree with data in other programming
languages, <a href="https://bioconductor.org/packages/treeio/">treeio</a> supports
exporting tree with data in the <code>jtree</code> format, which is JSON-based and can be easy to parse using any languages that supports JSON.</p>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/treeio/reference/write-jtree.html">write.jtree</a></span><span class="op">(</span><span class="va">tree2</span><span class="op">)</span></code></pre></div>
<pre><code>{
    "tree": "(((Prayidae_D27SS7@2825365:0.0682841{1},(Kephyes_ovata@2606431:0.0193941{2},Chuniphyes_multidentata@1277217:0.0121378{3}):0.0217782{20}):0.0607598{19},((Apolemia_sp_@1353964:0.11832{4},(((Bargmannia_amoena@263997:0.0144549{5},Bargmannia_elongata@946788:0.0149723{6}):0.0925388{25},Physonect_sp_@2066767:0.077429{7}):0.0274637{24},(Stephalia_dilata@2960089:0.0761163{8},((Frillagalma_vityazi@1155031:0.0906068{9},Resomia_ornicephala@3111757:1{10}e-06):1{28}e-06,((Lychnagalma_utricularia@2253871:0.120851{11},Nanomia_bijuga@717864:0.133939{12}):1{30}e-06,Cordagalma_sp_@1525873:0.0693814{13}):1{29}e-06):0.0333823{27}):1{26}e-06):0.0431861{23}):1{22}e-06,Rhizophysa_filiformis@3073669:0.22283{14}):0.0292362{21}):0.185603{18},(Hydra_magnipapillata@52244:0.0621782{15},Ectopleura_larynx@3556167:0.332505{16}):0.185603{31}){17};",
    "data":[
  {
    "edge_num": 1,
    "Ev": "S",
    "ND": 0,
    "S": 58,
    "fake_trait": 0.8103,
    "another_trait": 0.098
  },
  {
    "edge_num": 2,
    "Ev": "S",
    "ND": 1,
    "S": 69,
    "fake_trait": 1.0478,
    "another_trait": 0.2553
  },
  {
    "edge_num": 3,
    "Ev": "S",
    "ND": 2,
    "S": 70,
    "fake_trait": -0.5253,
    "another_trait": 0.0768
  },
  {
    "edge_num": 20,
    "Ev": "S",
    "ND": 3,
    "S": 60,
    "fake_trait": 1.1451,
    "another_trait": 0.3417
  },
  {
    "edge_num": 19,
    "Ev": "S",
    "ND": 4,
    "S": 36,
    "fake_trait": 1.4726,
    "another_trait": 0.5972
  },
  {
    "edge_num": 4,
    "Ev": "S",
    "ND": 9,
    "S": 31,
    "fake_trait": 1.2568,
    "another_trait": 0.2869
  },
  {
    "edge_num": 5,
    "Ev": "S",
    "ND": 10,
    "S": 37,
    "fake_trait": 1.2588,
    "another_trait": 0.8783
  },
  {
    "edge_num": 6,
    "Ev": "S",
    "ND": 11,
    "S": 38,
    "fake_trait": 0.2398,
    "another_trait": 0.3792
  },
  {
    "edge_num": 25,
    "Ev": "S",
    "ND": 12,
    "S": 33,
    "fake_trait": 2.5613,
    "another_trait": 0.4329
  },
  {
    "edge_num": 7,
    "Ev": "S",
    "ND": 13,
    "S": 61,
    "fake_trait": 0.7304,
    "another_trait": 0.4977
  },
  {
    "edge_num": 24,
    "Ev": "S",
    "ND": 14,
    "S": 24,
    "fake_trait": 0.8734,
    "another_trait": 0.1335
  },
  {
    "edge_num": 8,
    "Ev": "S",
    "ND": 15,
    "S": 52,
    "fake_trait": 1.3387,
    "another_trait": 0.7873
  },
  {
    "edge_num": 9,
    "Ev": "S",
    "ND": 16,
    "S": 53,
    "fake_trait": -0.7914,
    "another_trait": 0.4379
  },
  {
    "edge_num": 10,
    "Ev": "S",
    "ND": 17,
    "S": 54,
    "fake_trait": 0.1546,
    "another_trait": 0.1023
  },
  {
    "edge_num": 28,
    "Ev": "S",
    "ND": 18,
    "S": 45,
    "fake_trait": -0.1894,
    "another_trait": 0.1542
  },
  {
    "edge_num": 11,
    "Ev": "S",
    "ND": 19,
    "S": 65,
    "fake_trait": 0.5257,
    "another_trait": 0.9116
  },
  {
    "edge_num": 12,
    "Ev": "S",
    "ND": 20,
    "S": 71,
    "fake_trait": -0.9231,
    "another_trait": 0.9441
  },
  {
    "edge_num": 30,
    "Ev": "S",
    "ND": 21,
    "S": 56,
    "fake_trait": -0.5927,
    "another_trait": 0.5091
  },
  {
    "edge_num": 13,
    "Ev": "S",
    "ND": 22,
    "S": 64,
    "fake_trait": 0.9537,
    "another_trait": 0.1134
  },
  {
    "edge_num": 29,
    "Ev": "S",
    "ND": 23,
    "S": 46,
    "fake_trait": -0.3016,
    "another_trait": 0.5911
  },
  {
    "edge_num": 27,
    "Ev": "S",
    "ND": 24,
    "S": 40,
    "fake_trait": -0.2137,
    "another_trait": 0.8286
  },
  {
    "edge_num": 26,
    "Ev": "S",
    "ND": 25,
    "S": 35,
    "fake_trait": 0.6101,
    "another_trait": 0.7107
  },
  {
    "edge_num": 23,
    "Ev": "D",
    "ND": 26,
    "S": 24,
    "fake_trait": -0.9022,
    "another_trait": 0.945
  },
  {
    "edge_num": 22,
    "Ev": "S",
    "ND": 27,
    "S": 19,
    "fake_trait": 0.095,
    "another_trait": 0.1084
  },
  {
    "edge_num": 14,
    "Ev": "S",
    "ND": 28,
    "S": 26,
    "fake_trait": -0.1801,
    "another_trait": 0.4055
  },
  {
    "edge_num": 21,
    "Ev": "S",
    "ND": 29,
    "S": 17,
    "fake_trait": -1.9068,
    "another_trait": 0.1172
  },
  {
    "edge_num": 18,
    "Ev": "D",
    "ND": 8,
    "S": 17,
    "fake_trait": -0.033,
    "another_trait": 0.0023
  },
  {
    "edge_num": 15,
    "Ev": "S",
    "ND": 5,
    "S": 16,
    "fake_trait": 1.2558,
    "another_trait": 0.4273
  },
  {
    "edge_num": 16,
    "Ev": "S",
    "ND": 6,
    "S": 15,
    "fake_trait": 0.7386,
    "another_trait": 0.6203
  },
  {
    "edge_num": 31,
    "Ev": "S",
    "ND": 7,
    "S": 12,
    "fake_trait": 0.7259,
    "another_trait": 0.9045
  },
  {
    "edge_num": 17,
    "Ev": "S",
    "ND": 30,
    "S": 9,
    "fake_trait": -0.271,
    "another_trait": 0.9664
  }
],
    "metadata": {"info": "R-package treeio", "data": "Thu Sep  2 09:38:26 2021"}
}</code></pre>
<p>The <code>jtree</code> format is based on JSON and can be parsed using JSON parser.</p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">jtree_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">'.jtree'</span><span class="op">)</span>
<span class="fu"><a href="https://docs.ropensci.org/treeio/reference/write-jtree.html">write.jtree</a></span><span class="op">(</span><span class="va">tree2</span>, file <span class="op">=</span> <span class="va">jtree_file</span><span class="op">)</span>
<span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html">fromJSON</a></span><span class="op">(</span><span class="va">jtree_file</span><span class="op">)</span></code></pre></div>
<pre><code>$tree
[1] "(((Prayidae_D27SS7@2825365:0.0682841{1},(Kephyes_ovata@2606431:0.0193941{2},Chuniphyes_multidentata@1277217:0.0121378{3}):0.0217782{20}):0.0607598{19},((Apolemia_sp_@1353964:0.11832{4},(((Bargmannia_amoena@263997:0.0144549{5},Bargmannia_elongata@946788:0.0149723{6}):0.0925388{25},Physonect_sp_@2066767:0.077429{7}):0.0274637{24},(Stephalia_dilata@2960089:0.0761163{8},((Frillagalma_vityazi@1155031:0.0906068{9},Resomia_ornicephala@3111757:1{10}e-06):1{28}e-06,((Lychnagalma_utricularia@2253871:0.120851{11},Nanomia_bijuga@717864:0.133939{12}):1{30}e-06,Cordagalma_sp_@1525873:0.0693814{13}):1{29}e-06):0.0333823{27}):1{26}e-06):0.0431861{23}):1{22}e-06,Rhizophysa_filiformis@3073669:0.22283{14}):0.0292362{21}):0.185603{18},(Hydra_magnipapillata@52244:0.0621782{15},Ectopleura_larynx@3556167:0.332505{16}):0.185603{31}){17};"

$data
   edge_num Ev ND  S fake_trait another_trait
1         1  S  0 58     0.8103        0.0980
2         2  S  1 69     1.0478        0.2553
3         3  S  2 70    -0.5253        0.0768
4        20  S  3 60     1.1451        0.3417
5        19  S  4 36     1.4726        0.5972
6         4  S  9 31     1.2568        0.2869
7         5  S 10 37     1.2588        0.8783
8         6  S 11 38     0.2398        0.3792
9        25  S 12 33     2.5613        0.4329
10        7  S 13 61     0.7304        0.4977
11       24  S 14 24     0.8734        0.1335
12        8  S 15 52     1.3387        0.7873
13        9  S 16 53    -0.7914        0.4379
14       10  S 17 54     0.1546        0.1023
15       28  S 18 45    -0.1894        0.1542
16       11  S 19 65     0.5257        0.9116
17       12  S 20 71    -0.9231        0.9441
18       30  S 21 56    -0.5927        0.5091
19       13  S 22 64     0.9537        0.1134
20       29  S 23 46    -0.3016        0.5911
21       27  S 24 40    -0.2137        0.8286
22       26  S 25 35     0.6101        0.7107
23       23  D 26 24    -0.9022        0.9450
24       22  S 27 19     0.0950        0.1084
25       14  S 28 26    -0.1801        0.4055
26       21  S 29 17    -1.9068        0.1172
27       18  D  8 17    -0.0330        0.0023
28       15  S  5 16     1.2558        0.4273
29       16  S  6 15     0.7386        0.6203
30       31  S  7 12     0.7259        0.9045
31       17  S 30  9    -0.2710        0.9664

$metadata
$metadata$info
[1] "R-package treeio"

$metadata$data
[1] "Thu Sep  2 09:38:26 2021"</code></pre>
<p>The <code>jtree</code> file can be directly imported as a <code>treedata</code> object using
the <code><a href="https://docs.ropensci.org/treeio/reference/read-jtree.html">read.jtree()</a></code> function provided also
in <a href="https://bioconductor.org/packages/treeio/">treeio</a> package (see also <a href="chapter1.html#jtree">session 1.3</a>).</p>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/treeio/reference/read-jtree.html">read.jtree</a></span><span class="op">(</span><span class="va">jtree_file</span><span class="op">)</span></code></pre></div>
<pre><code>## 'treedata' S4 object that stored information of
##  '/tmp/RtmpEM0F0I/file678ab75000.jtree'.
## 
## ...@ phylo:
## 
## Phylogenetic tree with 16 tips and 15 internal nodes.
## 
## Tip labels:
##   Prayidae_D27SS7@2825365, Kephyes_ovata@2606431, Chuniphyes_multidentata@1277217, Apolemia_sp_@1353964, Bargmannia_amoena@263997, Bargmannia_elongata@946788, ...
## 
## Rooted; includes branch lengths.
## 
## with the following features available:
##  'Ev',   'ND',   'S',    'fake_trait',   'another_trait'.
## 
## # The associated data tibble abstraction: 31 × 8
## # The 'node', 'label' and 'isTip' are from the phylo tree.
##     node label            isTip Ev       ND     S fake_trait
##    &lt;int&gt; &lt;chr&gt;            &lt;lgl&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt;      &lt;dbl&gt;
##  1     1 Prayidae_D27SS7… TRUE  S         0    58      0.810
##  2     2 Kephyes_ovata@2… TRUE  S         1    69      1.05 
##  3     3 Chuniphyes_mult… TRUE  S         2    70     -0.525
##  4     4 Apolemia_sp_@13… TRUE  S         9    31      1.26 
##  5     5 Bargmannia_amoe… TRUE  S        10    37      1.26 
##  6     6 Bargmannia_elon… TRUE  S        11    38      0.240
##  7     7 Physonect_sp_@2… TRUE  S        13    61      0.730
##  8     8 Stephalia_dilat… TRUE  S        15    52      1.34 
##  9     9 Frillagalma_vit… TRUE  S        16    53     -0.791
## 10    10 Resomia_ornicep… TRUE  S        17    54      0.155
## # … with 21 more rows, and 1 more variable:
## #   another_trait &lt;dbl&gt;</code></pre>
</div>
<div id="summary3" class="section level2" number="3.4">
<h2>
<span class="header-section-number">3.4</span> Summary<a class="anchor" aria-label="anchor" href="#summary3"><i class="fas fa-link"></i></a>
</h2>
<p>Phylogenetic tree associated data is often stored in a separate file and need expertise to map the data to the tree structure. Lacking standardization to store and represent phylogeny and associated data, makes it difficult for researchers to access and integrate the phylogenetic data into their studies. The <a href="http://bioconductor.org/packages/treeio">treeio</a> package provides functions to import phylogeny with associated data from a number of sources, including analysis finding from commonly used software and external data such as experimental, clinical or meta data. These tree + data can be exported into a single file as <code>BEAST</code> or <code>jtree</code> formats, and the output file can be parsed back to R by <a href="http://bioconductor.org/packages/treeio">treeio</a> and the data is easy to access. The input and output utilities supplied by <a href="http://bioconductor.org/packages/treeio">treeio</a> package lay the foundation for phylogenetic data integration for downstream comparative study and visualization.</p>

</div>
</div>



  <div class="chapter-nav">
<div class="prev"><a href="chapter2.html"><span class="header-section-number">2</span> Manipulating Tree with Data</a></div>
<div class="next"><a href="chapter4.html"><span class="header-section-number">4</span> Phylogenetic Tree Visualization</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#chapter3"><span class="header-section-number">3</span> Exporting tree with data</a></li>
<li><a class="nav-link" href="#introduction-1"><span class="header-section-number">3.1</span> Introduction</a></li>
<li>
<a class="nav-link" href="#exporting-tree-data-to-beast-nexus-format"><span class="header-section-number">3.2</span> Exporting Tree Data to BEAST Nexus Format</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#exportingconverting-software-output"><span class="header-section-number">3.2.1</span> Exporting/converting software output</a></li>
<li><a class="nav-link" href="#combining-tree-with-external-data"><span class="header-section-number">3.2.2</span> Combining tree with external data</a></li>
<li><a class="nav-link" href="#merging-tree-data-from-different-sources"><span class="header-section-number">3.2.3</span> Merging tree data from different sources</a></li>
</ul>
</li>
<li><a class="nav-link" href="#write-jtree"><span class="header-section-number">3.3</span> Exporting Tree Data to jtree Format</a></li>
<li><a class="nav-link" href="#summary3"><span class="header-section-number">3.4</span> Summary</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Data Integration, Manipulation and Visualization of Phylogenetic Trees</strong>" was written by Guangchuang Yu. It was last built on 2021-09-02.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
